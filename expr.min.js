!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JsonicExpr=e()}}((function(){var e={exports:{}};(function(n){(function(){!function(t){"object"==typeof e.exports?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).Jsonic=t()}((function(){var e=function(e){var n;return function(t){return n||e(n={exports:{},parent:t},n.exports),n.exports}},n=e((function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.values=n.keys=n.omap=n.str=n.prop=n.normalt=n.parserwrap=n.trimstk=n.tokenize=n.srcfmt=n.snip=n.regexp=n.mesc=n.makelog=n.isarr=n.filterRules=n.extract=n.escre=n.errinject=n.errdesc=n.entries=n.defprop=n.deep=n.configure=n.clone=n.clean=n.charset=n.badlex=n.assign=n.S=n.JsonicError=void 0;const i=t({}),l=e=>null==e?[]:Object.keys(e);n.keys=l,n.values=e=>null==e?[]:Object.values(e),n.entries=e=>null==e?[]:Object.entries(e);const s=(e,...n)=>Object.assign(null==e?{}:e,...n);n.assign=s,n.isarr=e=>Array.isArray(e);const o=Object.defineProperty;n.defprop=o;const a=(e,n)=>Object.entries(e||{}).reduce((e,t)=>{let r=n?n(t):t;void 0===r[0]?delete e[t[0]]:e[r[0]]=r[1];let i=2;for(;void 0!==r[i];)e[r[i]]=r[i+1],i+=2;return e},{});n.omap=a;const c={object:"object",string:"string",function:"function",unexpected:"unexpected",map:"map",list:"list",elem:"elem",pair:"pair",val:"val",node:"node",no_re_flags:r.EMPTY,unprintable:"unprintable",invalid_ascii:"invalid_ascii",invalid_unicode:"invalid_unicode",invalid_lex_state:"invalid_lex_state",unterminated_string:"unterminated_string",unterminated_comment:"unterminated_comment",lex:"lex",parse:"parse",error:"error",none:"none",imp_map:"imp,map",imp_list:"imp,list",imp_null:"imp,null",end:"end",open:"open",close:"close",rule:"rule",stack:"stack",nUll:"null",name:"name",make:"make"};n.S=c;class p extends SyntaxError{constructor(e,n,t,r,i){let l=v(e,n=f({},n),t,r,i);super(l.message),s(this,l),x(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}function u(e,n,t){let i=n.t,l=i[e];return null==l&&r.STRING===typeof e&&(i[l=n.tI++]=e,i[e]=l,i[e.substring(1)]=l,null!=t&&s(t.token,n.t)),l}function d(e,...n){return new RegExp(n.map(e=>e.esc?m(e.toString()):e).join(r.EMPTY),null==e?"":e)}function m(e){return null==e?"":e.replace(/[-\\|\]{}()[^$+*?.!=]/g,"\\$&").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function f(e,...n){let t=c.function===typeof e,r=null!=e&&(c.object===typeof e||t);for(let i of n){let n=c.function===typeof i,l=null!=i&&(c.object===typeof i||n);if(r&&l&&!n&&Array.isArray(e)===Array.isArray(i))for(let t in i)e[t]=f(e[t],i[t]);else e=void 0===i?e:n?i:l?f(Array.isArray(i)?[]:{},i):i,t=c.function===typeof e,r=null!=e&&(c.object===typeof e||t)}return e}function h(e,n,t,r,i,l){let s={code:n,details:t,token:r,rule:i,ctx:l};return null==e?"":e.replace(/\$([\w_]+)/g,(e,n)=>{let o=JSON.stringify(null!=s[n]?s[n]:null!=t[n]?t[n]:l.meta&&null!=l.meta[n]?l.meta[n]:null!=r[n]?r[n]:null!=i[n]?i[n]:null!=l.opts[n]?l.opts[n]:null!=l.cfg[n]?l.cfg[n]:null!=l[n]?l[n]:"$"+n);return null==o?"":o})}function x(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function g(e,n,t){let i=0<t.sI?t.sI:0,l=0<t.rI?t.rI:1,s=0<t.cI?t.cI:1,o=null==t.src?r.EMPTY:t.src,a=e.substring(Math.max(0,i-333),i).split("\n"),c=e.substring(i,i+333).split("\n"),p=2+(r.EMPTY+(l+2)).length,u=l<3?1:l-2,d=e=>"\x1b[34m"+(r.EMPTY+u++).padStart(p," ")+" | \x1b[0m"+(null==e?r.EMPTY:e),m=a.length;return[2<m?d(a[m-3]):null,1<m?d(a[m-2]):null,d(a[m-1]+c[0])," ".repeat(p)+"   "+" ".repeat(s-1)+"\x1b[31m"+"^".repeat(o.length||1)+" "+n+"\x1b[0m",d(c[1]),d(c[2])].filter(e=>null!=e).join("\n")}function v(e,n,t,r,i){try{let l=i.cfg,s=i.meta,o=h(l.error[e]||l.error.unknown,e,n,t,r,i);c.function===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let a=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+o,"  \x1b[34m--\x3e\x1b[0m "+(s&&s.fileName||"<no-file>")+":"+t.rI+":"+t.cI,g(i.src(),o,t),"",h((l.hint[e]||l.hint.unknown||"").trim().split("\n").map(e=>"  "+e).join("\n"),e,n,t,r,i),"","  \x1b[2mhttps://jsonic.senecajs.org\x1b[0m","  \x1b[2m--internal: rule="+r.name+"~"+r.state+"; token="+u(t.tin,i.cfg)+(null==t.why?"":"~"+t.why)+"; plugins="+i.plgn().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),p={internal:{token:t,ctx:i}};return p={...Object.create(p),message:a,code:e,details:n,meta:s,fileName:s?s.fileName:void 0,lineNumber:t.rI,columnNumber:t.cI}}catch(l){return console.log(l),{}}}function k(e){return"function"==typeof e.debug.print.src?e.debug.print.src:(n,t)=>null==n?r.EMPTY:(t=JSON.stringify(n)).substring(0,e.debug.maxlen)+(e.debug.maxlen<t.length?"...":r.EMPTY)}function b(e,n=44){let t;try{t="object"==typeof e?JSON.stringify(e):""+e}catch(r){t=""+e}return y(n<t.length?t.substring(0,n-3)+"...":t,n)}function y(e,n=5){return void 0===e?"":(""+e).substring(0,n).replace(/[\r\n\t]/g,".")}function _(...e){return null==e?{}:e.filter(e=>!1!==e).map(e=>"object"==typeof e?l(e).join(r.EMPTY):e).join(r.EMPTY).split(r.EMPTY).reduce((e,n)=>(e[n]=n.charCodeAt(0),e),{})}function E(e){for(let n in e)null==e[n]&&delete e[n];return e}n.JsonicError=p,n.configure=function(e,n,t){var r,i,o,c,p,f,h,x,g,v,k,b,y,I,M,O,S,T,j,P,N,C,w,R,A,L,F,Y,U,$,J,B,K,Z,z,D,V;const q=n||{};q.t=q.t||{},q.tI=q.tI||1;const G=e=>u(e,q);!1!==t.grammar$&&(G("#BD"),G("#ZZ"),G("#UK"),G("#AA"),G("#SP"),G("#LN"),G("#CM"),G("#NR"),G("#ST"),G("#TX"),G("#VL")),q.fixed={lex:!!(null===(r=t.fixed)||void 0===r?void 0:r.lex),token:t.fixed?a(E(t.fixed.token),([e,n])=>[n,u(e,q)]):{},ref:void 0},q.fixed.ref=a(q.fixed.token,([e,n])=>[e,n]),q.fixed.ref=Object.assign(q.fixed.ref,a(q.fixed.ref,([e,n])=>[n,e])),q.tokenSet={ignore:Object.fromEntries(((null===(i=t.tokenSet)||void 0===i?void 0:i.ignore)||[]).map(e=>[G(e),!0]))},q.space={lex:!!(null===(o=t.space)||void 0===o?void 0:o.lex),chars:_(null===(c=t.space)||void 0===c?void 0:c.chars)},q.line={lex:!!(null===(p=t.line)||void 0===p?void 0:p.lex),chars:_(null===(f=t.line)||void 0===f?void 0:f.chars),rowChars:_(null===(h=t.line)||void 0===h?void 0:h.rowChars)},q.text={lex:!!(null===(x=t.text)||void 0===x?void 0:x.lex),modify:((null===(g=q.text)||void 0===g?void 0:g.modify)||[]).concat(([null===(v=t.text)||void 0===v?void 0:v.modify]||[]).flat()).filter(e=>null!=e)},q.number={lex:!!(null===(k=t.number)||void 0===k?void 0:k.lex),hex:!!(null===(b=t.number)||void 0===b?void 0:b.hex),oct:!!(null===(y=t.number)||void 0===y?void 0:y.oct),bin:!!(null===(I=t.number)||void 0===I?void 0:I.bin),sep:null!=(null===(M=t.number)||void 0===M?void 0:M.sep)&&""!==t.number.sep,sepChar:null===(O=t.number)||void 0===O?void 0:O.sep},q.value={lex:!!(null===(S=t.value)||void 0===S?void 0:S.lex),map:(null===(T=t.value)||void 0===T?void 0:T.map)||{}},q.rule={start:null==(null===(j=t.rule)||void 0===j?void 0:j.start)?"val":t.rule.start,maxmul:null==(null===(P=t.rule)||void 0===P?void 0:P.maxmul)?3:t.rule.maxmul,finish:!!(null===(N=t.rule)||void 0===N?void 0:N.finish),include:(null===(C=t.rule)||void 0===C?void 0:C.include)?t.rule.include.split(/\s*,+\s*/).filter(e=>""!==e):[],exclude:(null===(w=t.rule)||void 0===w?void 0:w.exclude)?t.rule.exclude.split(/\s*,+\s*/).filter(e=>""!==e):[]},q.map={extend:!!(null===(R=t.map)||void 0===R?void 0:R.extend),merge:null===(A=t.map)||void 0===A?void 0:A.merge};let W=Object.keys(q.fixed.token).sort((e,n)=>n.length-e.length).map(e=>m(e)).join("|"),H=(null===(L=t.comment)||void 0===L?void 0:L.lex)?(t.comment.marker||[]).filter(e=>e.lex).map(e=>m(e.start)).join("|"):"",X=["([",m(l(_(q.space.lex&&q.space.chars,q.line.lex&&q.line.chars)).join("")),"]",("string"==typeof t.ender?t.ender.split(""):Array.isArray(t.ender)?t.ender:[]).map(e=>"|"+m(e)).join(""),""===W?"":"|",W,""===H?"":"|",H,"|$)"];return q.rePart={fixed:W,ender:X,commentStart:H},q.re={ender:d(null,...X),rowChars:d(null,m(null===(F=t.line)||void 0===F?void 0:F.rowChars)),columns:d(null,"["+m(null===(Y=t.line)||void 0===Y?void 0:Y.chars)+"]","(.*)$")},q.lex={empty:!!(null===(U=t.lex)||void 0===U?void 0:U.empty),match:(null===($=t.lex)||void 0===$?void 0:$.match)?t.lex.match.map(e=>e(q,t)):[]},q.debug={get_console:(null===(J=t.debug)||void 0===J?void 0:J.get_console)||(()=>console),maxlen:null==(null===(B=t.debug)||void 0===B?void 0:B.maxlen)?99:t.debug.maxlen,print:{config:!!(null===(Z=null===(K=t.debug)||void 0===K?void 0:K.print)||void 0===Z?void 0:Z.config),src:null===(D=null===(z=t.debug)||void 0===z?void 0:z.print)||void 0===D?void 0:D.src}},q.error=t.error||{},q.hint=t.hint||{},(null===(V=t.config)||void 0===V?void 0:V.modify)&&l(t.config.modify).forEach(e=>t.config.modify[e](q,t)),q.debug.print.config&&q.debug.get_console().dir(q,{depth:null}),s(e.options,t),s(e.token,q.t),s(e.fixed,q.fixed.ref),q},n.tokenize=u,n.mesc=function(e,n){return(n=new String(e)).esc=!0,n},n.regexp=d,n.escre=m,n.deep=f,n.errinject=h,n.trimstk=x,n.extract=g,n.errdesc=v,n.badlex=function(e,n,t){let r=r=>{let i=e.next(r);if(n===i.tin){let e={};throw null!=i.use&&(e.use=i.use),new p(i.why||c.unexpected,e,i,r,t)}return i};return r.src=e.src,r},n.makelog=function(e,n){if(n)if("number"==typeof n.log){let t=!1,r=n.log;-1===r&&(r=1,t=!0),e.log=(...n)=>{if(t){let t=n.filter(e=>c.object!=typeof e).map(e=>c.function==typeof e?e.name:e).join("\t");e.cfg.debug.get_console().log(t)}else e.cfg.debug.get_console().dir(n,{depth:r})}}else"function"==typeof n.log&&(e.log=n.log);return e.log},n.srcfmt=k,n.str=b,n.snip=y,n.clone=function(e){return f(Object.create(Object.getPrototypeOf(e)),e)},n.charset=_,n.clean=E,n.filterRules=function(e,n){let t=["open","close"];for(let r of t)e.def[r]=e.def[r].map(e=>(e.g="string"==typeof e.g?(e.g||"").split(/\s*,+\s*/):e.g||[],e)).filter(e=>n.rule.include.reduce((n,t)=>n||null!=e.g&&-1!==e.g.indexOf(t),0===n.rule.include.length)).filter(e=>n.rule.exclude.reduce((n,t)=>n&&(null==e.g||-1===e.g.indexOf(t)),!0));return e},n.normalt=function(e){if(null!=e.c){let n=e.c.n,t=e.c.d;null==n&&null==t||(e.c=function(e){let r=!0;if(null!=n)for(let t in n)r=r&&(null==e.n[t]||e.n[t]<=(null==n[t]?0:n[t]));return null!=t&&(r=r&&e.d<=t),r},null!=n&&(e.c.n=n),null!=t&&(e.c.d=t))}if(r.STRING===typeof e.g&&(e.g=e.g.split(/\s*,\s*/)),e.s&&0!==e.s.length){const n=e=>e.flat().filter(e=>"number"==typeof e),t=(e,n)=>e.filter(e=>31*n<=e&&e<31*(n+1)),r=(e,n)=>e.reduce((e,t)=>1<<t-(31*n+1)|e,0),i=n([e.s[0]]),l=n([e.s[1]]),s=e;s.S0=0<i.length?new Array(Math.max(...i.map(e=>1+e/31|0))).fill(null).map((e,n)=>n).map(e=>r(t(i,e),e)):null,s.S1=0<l.length?new Array(Math.max(...l.map(e=>1+e/31|0))).fill(null).map((e,n)=>n).map(e=>r(t(l,e),e)):null}else e.s=null;return e},n.prop=function(e,n,t){try{let r,i=n.split(".");for(let n=0;n<i.length;n++)r=i[n],n<i.length-1&&(e=e[r]=e[r]||{});return void 0!==t&&(e[r]=t),e[r]}catch(i){throw new Error("Cannot "+(void 0===t?"get":"set")+" path "+n+" on object: "+b(r)+(void 0===t?"":" to value: "+b(t,22)))}},n.parserwrap=function(e){return{start:function(n,t,l,s){try{return e.start(n,t,l,s)}catch(o){if("SyntaxError"===o.name){let s=0,a=0,c=0,d=r.EMPTY,m=o.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(m){d=m[1],s=parseInt(m[2]),a=n.substring(0,s).replace(/[^\n]/g,r.EMPTY).length;let e=s-1;for(;-1<e&&"\n"!==n.charAt(e);)e--;c=Math.max(n.substring(e,s).length,0)}let f=o.token||(0,i.makeToken)("#UK",u("#UK",t.internal().config),void 0,d,(0,i.makePoint)(d.length,s,o.lineNumber||a,o.columnNumber||c));throw new p(o.code||"json",o.details||{msg:o.message},f,{},o.ctx||{uI:-1,opts:t.options,cfg:t.internal().config,token:f,meta:l,src:()=>n,root:()=>{},plgn:()=>t.internal().plugins,rule:{name:"no-rule"},xs:-1,v2:f,v1:f,t0:f,t1:f,tC:-1,rs:[],rsI:0,next:()=>f,rsm:{},n:{},log:l?l.log:void 0,F:k(t.internal().config),use:{},NORULE:{name:"no-rule"},NOTOKEN:{name:"no-token"}})}throw o}}}}})),t=e((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeTextMatcher=t.makeNumberMatcher=t.makeCommentMatcher=t.makeStringMatcher=t.makeLineMatcher=t.makeSpaceMatcher=t.makeFixedMatcher=t.makeToken=t.makePoint=t.makeLex=t.makeNoToken=void 0;const i=n({});class l{constructor(e,n,t,r){this.len=-1,this.sI=0,this.rI=1,this.cI=1,this.token=[],this.len=e,null!=n&&(this.sI=n),null!=t&&(this.rI=t),null!=r&&(this.cI=r)}toString(){return"Point["+[this.sI+"/"+this.len,this.rI,this.cI]+(0<this.token.length?" "+this.token:"")+"]"}[r.INSPECT](){return this.toString()}}const s=(...e)=>new l(...e);t.makePoint=s;class o{constructor(e,n,t,i,l,s,o){this.isToken=!0,this.name=r.EMPTY,this.tin=-1,this.val=void 0,this.src=r.EMPTY,this.sI=-1,this.rI=-1,this.cI=-1,this.len=-1,this.name=e,this.tin=n,this.src=i,this.val=t,this.sI=l.sI,this.rI=l.rI,this.cI=l.cI,this.use=s,this.why=o,this.len=null==i?0:i.length}resolveVal(e,n){return"function"==typeof this.val?this.val(e,n):this.val}bad(e,n){return this.err=e,null!=n&&(this.use=(0,i.deep)(this.use||{},n)),this}toString(){return"Token["+this.name+"="+this.tin+" "+(0,i.snip)(this.src)+(void 0===this.val||"#ST"===this.name||"#TX"===this.name?"":"="+(0,i.snip)(this.val))+" "+[this.sI,this.rI,this.cI]+(null==this.use?"":" "+(0,i.snip)(""+JSON.stringify(this.use).replace(/"/g,""),22))+(null==this.err?"":" "+this.err)+(null==this.why?"":" "+(0,i.snip)(""+this.why,22))+"]"}[r.INSPECT](){return this.toString()}}const a=(...e)=>new o(...e);function c(e,n,t){let r=e.pnt,i=n;if(e.cfg.fixed.lex&&null!=t&&0<t.length){let l=void 0,s=e.cfg.fixed.token[t];null!=s&&(l=e.token(s,void 0,t,r)),null!=l&&(r.sI+=l.src.length,r.cI+=l.src.length,null==n?i=l:r.token.push(l))}return i}t.makeToken=a,t.makeNoToken=()=>a("",-1,void 0,r.EMPTY,s(-1)),t.makeFixedMatcher=(e,n)=>{let t=(0,i.regexp)(null,"^(",e.rePart.fixed,")");return function(n){let r=e.fixed;if(!r.lex)return;let i=n.pnt,l=n.src.substring(i.sI).match(t);if(l){let e=l[1],t=e.length;if(0<t){let l=void 0,s=r.token[e];return null!=s&&(l=n.token(s,void 0,e,i),i.sI+=t,i.cI+=t),l}}}},t.makeCommentMatcher=(e,n)=>{let t=n.comment;e.comment={lex:!!t&&!!t.lex,marker:((null==t?void 0:t.marker)||[]).map(e=>({start:e.start,end:e.end,line:!!e.line,lex:!!e.lex}))};let r=e.comment.lex?e.comment.marker.filter(e=>e.lex&&e.line):[],l=e.comment.lex?e.comment.marker.filter(e=>e.lex&&!e.line):[];return function(n){if(!e.comment.lex)return;let t=n.pnt,s=n.src.substring(t.sI),o=t.rI,a=t.cI;for(let i of r)if(s.startsWith(i.start)){let r=s.length,l=i.start.length;for(a+=i.start.length;l<r&&!e.line.chars[s[l]];)a++,l++;let o=s.substring(0,l),c=n.token("#CM",void 0,o,t);return t.sI+=o.length,t.cI=a,c}for(let r of l)if(s.startsWith(r.start)){let l=s.length,c=r.start.length,p=r.end;for(a+=r.start.length;c<l&&!s.substring(c).startsWith(p);)e.line.rowChars[s[c]]&&(o++,a=0),a++,c++;if(s.substring(c).startsWith(p)){a+=p.length;let e=s.substring(0,c+p.length),r=n.token("#CM",void 0,e,t);return t.sI+=e.length,t.rI=o,t.cI=a,r}return n.bad(i.S.unterminated_comment,t.sI,t.sI+9*r.start.length)}}},t.makeTextMatcher=(e,n)=>{let t=(0,i.regexp)(e.line.lex?null:"s","^(.*?)",...e.rePart.ender);return function(r){let i=e.text,l=r.pnt,s=r.src.substring(l.sI),o=e.value.map,a=s.match(t);if(a){let t=a[1],s=a[2],p=void 0;if(null!=t){let n=t.length;if(0<n){let s=void 0;e.value.lex&&void 0!==(s=o[t])?(p=r.token("#VL",s.val,t,l),l.sI+=n,l.cI+=n):i.lex&&(p=r.token("#TX",t,t,l),l.sI+=n,l.cI+=n)}}if(p&&(p=c(r,p,s)),p&&0<e.text.modify.length){const t=e.text.modify;for(let i=0;i<t.length;i++)p.val=t[i](p.val,r,e,n)}return p}}},t.makeNumberMatcher=(e,n)=>{let t=e.number,r=(0,i.regexp)(null,["^([-+]?(0(",[t.hex?"x[0-9a-fA-F_]+":null,t.oct?"o[0-7_]+":null,t.bin?"b[01_]+":null].filter(e=>null!=e).join("|"),")|[.0-9]+([0-9_]*[0-9])?)","(\\.[0-9]?([0-9_]*[0-9])?)?","([eE][-+]?[0-9]+([0-9_]*[0-9])?)?"].join("").replace(/_/g,t.sep?(0,i.escre)(t.sepChar):""),")",...e.rePart.ender),l=t.sep?(0,i.regexp)("g",(0,i.escre)(t.sepChar)):void 0;return function(n){if(!(t=e.number).lex)return;let i=n.pnt,s=n.src.substring(i.sI),o=e.value.map,a=s.match(r);if(a){let t=a[1],r=a[9],s=void 0;if(null!=t){let r=t.length;if(0<r){let a=void 0;if(e.value.lex&&void 0!==(a=o[t]))s=n.token("#VL",a.val,t,i);else{let e=l?t.replace(l,""):t,o=+e;if(isNaN(o)){let n=e[0];"-"!==n&&"+"!==n||(o=("-"===n?-1:1)*+e.substring(1))}isNaN(o)||(s=n.token("#NR",o,t,i),i.sI+=r,i.cI+=r)}}}return s=c(n,s,r)}}},t.makeStringMatcher=(e,n)=>{let t=n.string||{};return e.string=e.string||{},e.string=(0,i.deep)(e.string,{lex:!!(null==t?void 0:t.lex),quoteMap:(0,i.charset)(t.chars),multiChars:(0,i.charset)(t.multiChars),escMap:(0,i.clean)({...t.escape}),escChar:t.escapeChar,escCharCode:null==t.escapeChar?void 0:t.escapeChar.charCodeAt(0),allowUnknown:!!t.allowUnknown,replaceCodeMap:(0,i.omap)((0,i.clean)({...t.replace}),([e,n])=>[e.charCodeAt(0),n]),hasReplace:!1}),e.string.hasReplace=0<(0,i.keys)(e.string.replaceCodeMap).length,function(n){let t=e.string;if(!t.lex)return;let{quoteMap:l,escMap:s,escChar:o,escCharCode:a,multiChars:c,allowUnknown:p,replaceCodeMap:u,hasReplace:d}=t,{pnt:m,src:f}=n,{sI:h,rI:x,cI:g}=m,v=f.length;if(l[f[h]]){const t=f[h],l=h,k=x,b=c[t];++h,++g;let y,_=[];for(;h<v;h++){g++;let r=f[h];if(y=void 0,t===r){h++;break}if(o===r){g++;let e=s[f[++h]];if(null!=e)_.push(e);else if("x"===f[h]){h++;let e=parseInt(f.substring(h,h+2),16);if(isNaN(e))return h-=2,g-=2,m.sI=h,m.cI=g,n.bad(i.S.invalid_ascii,h,h+4);let t=String.fromCharCode(e);_.push(t),h+=1,g+=2}else if("u"===f[h]){let e="{"===f[++h]?(h++,1):0,t=e?6:4,r=parseInt(f.substring(h,h+t),16);if(isNaN(r))return h=h-2-e,g-=2,m.sI=h,m.cI=g,n.bad(i.S.invalid_unicode,h,h+t+2+2*e);let l=String.fromCodePoint(r);_.push(l),h+=t-1+e,g+=t+e}else{if(!p)return m.sI=h,m.cI=g-1,n.bad(i.S.unexpected,h,h+1);_.push(f[h])}}else if(d&&void 0!==(y=u[f.charCodeAt(h)]))_.push(y),g++;else{let r=h,l=t.charCodeAt(0),s=f.charCodeAt(h);for(;(!d||void 0===(y=u[s]))&&h<v&&32<=s&&l!==s&&a!==s;)s=f.charCodeAt(++h),g++;if(g--,void 0===y&&s<32){if(!b||!e.line.chars[f[h]])return m.sI=h,m.cI=g,n.bad(i.S.unprintable,h,h+1);e.line.rowChars[f[h]]&&(m.rI=++x),g=1,_.push(f.substring(r,h+1))}else _.push(f.substring(r,h)),h--}}if(f[h-1]!==t||m.sI===h-1)return m.rI=k,n.bad(i.S.unterminated_string,l,h);const E=n.token("#ST",_.join(r.EMPTY),f.substring(m.sI,h),m);return m.sI=h,m.rI=x,m.cI=g,E}}},t.makeLineMatcher=(e,n)=>function(n){if(!e.line.lex)return;let{chars:t,rowChars:r}=e.line,{pnt:i,src:l}=n,{sI:s,rI:o}=i;for(;t[l[s]];)o+=r[l[s]]?1:0,s++;if(i.sI<s){let e=l.substring(i.sI,s);const t=n.token("#LN",void 0,e,i);return i.sI+=e.length,i.rI=o,i.cI=1,t}},t.makeSpaceMatcher=(e,n)=>function(n){if(!e.space.lex)return;let{chars:t}=e.space,{pnt:r,src:i}=n,{sI:l,cI:s}=r;for(;t[i[l]];)l++,s++;if(r.sI<l){let e=i.substring(r.sI,l);const t=n.token("#SP",void 0,e,r);return r.sI+=e.length,r.cI=s,t}};class p{constructor(e){this.src=r.EMPTY,this.ctx={},this.cfg={},this.pnt=s(-1),this.ctx=e,this.src=e.src(),this.cfg=e.cfg,this.pnt=s(this.src.length)}token(e,n,t,r,l,s){let o,c;return"string"==typeof e?(c=e,o=(0,i.tokenize)(c,this.cfg)):(o=e,c=(0,i.tokenize)(e,this.cfg)),a(c,o,n,t,r||this.pnt,l,s)}next(e){let n,t=this.pnt;if(t.end)n=t.end;else if(0<t.token.length)n=t.token.shift();else if(t.len<=t.sI)t.end=this.token("#ZZ",void 0,"",t),n=t.end;else{for(let t of this.cfg.lex.match)if(n=t(this,e))break;n=n||this.token("#BD",void 0,this.src[t.sI],t,void 0,"unexpected")}return this.ctx.log&&this.ctx.log(i.S.lex,(0,i.tokenize)(n.tin,this.cfg),this.ctx.F(n.src),t.sI,t.rI+":"+t.cI),n}tokenize(e){return(0,i.tokenize)(e,this.cfg)}bad(e,n,t){return this.token("#BD",void 0,0<=n&&n<=t?this.src.substring(n,t):this.src[this.pnt.sI],void 0,void 0,e)}}t.makeLex=(...e)=>new p(...e)})),r={};Object.defineProperty(r,"__esModule",{value:!0}),r.STRING=r.INSPECT=r.EMPTY=r.AFTER=r.BEFORE=r.CLOSE=r.OPEN=void 0,r.OPEN="o",r.CLOSE="c",r.BEFORE="b",r.AFTER="a",r.EMPTY="",r.INSPECT=Symbol.for("nodejs.util.inspect.custom"),r.STRING="string";var i={};Object.defineProperty(i,"__esModule",{value:!0}),i.defaults=void 0;const l=t({}),s={tag:"-",fixed:{lex:!0,token:{"#OB":"{","#CB":"}","#OS":"[","#CS":"]","#CL":":","#CA":","}},tokenSet:{ignore:["#SP","#LN","#CM"]},space:{lex:!0,chars:" \t"},line:{lex:!0,chars:"\r\n",rowChars:"\n"},text:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,sep:"_"},comment:{lex:!0,marker:[{line:!0,start:"#",lex:!0},{line:!0,start:"//",lex:!0},{line:!1,start:"/*",end:"*/",lex:!0}]},string:{lex:!0,chars:"'\"`",multiChars:"`",escapeChar:"\\",escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",'"':'"',"'":"'","`":"`","\\":"\\","/":"/"},allowUnknown:!0},map:{extend:!0,merge:void 0},value:{lex:!0,map:{true:{val:!0},false:{val:!1},null:{val:null}}},ender:[],plugin:{},debug:{get_console:()=>console,maxlen:99,print:{config:!1,src:void 0}},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated_string:"unterminated string: $src",unterminated_comment:"unterminated comment: $src",unknown_rule:"unknown rule: $rulename"},hint:function(e=((e,n="replace")=>e[n](/[A-Z]/g,e=>" "+e.toLowerCase())[n](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),n="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!\n\n~code: $code,~details: \n$details|~theCharacter(s) $srcWereNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~thisStringHasNoEndQuote.|~thisCommentIsNeverClosed.|~noRuleNamed $rulenameIsDefined.~thisIsProbablyAnErrorInThe\ngrammarOfAPlugin.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated_string|unterminated_comment|unknown_rule".split("|").reduce((t,r,i)=>(t[r]=e(n[i]),t),{})},lex:{match:[l.makeFixedMatcher,l.makeSpaceMatcher,l.makeLineMatcher,l.makeStringMatcher,l.makeCommentMatcher,l.makeNumberMatcher,l.makeTextMatcher],empty:!0},rule:{start:"val",finish:!0,maxmul:3,include:"",exclude:""},config:{modify:{}},parser:{start:void 0}};i.defaults=s;var o={};Object.defineProperty(o,"__esModule",{value:!0}),o.Parser=o.makeRuleSpec=o.makeRule=void 0;const a=n({}),c=t({});class p{constructor(e,n,t){this.id=-1,this.name=r.EMPTY,this.node=null,this.state=r.OPEN,this.n={},this.d=-1,this.use={},this.bo=!1,this.ao=!1,this.bc=!1,this.ac=!1,this.os=0,this.cs=0,this.id=n.uI++,this.name=e.name,this.spec=e,this.child=n.NORULE,this.parent=n.NORULE,this.prev=n.NORULE,this.o0=n.NOTOKEN,this.o1=n.NOTOKEN,this.c0=n.NOTOKEN,this.c1=n.NOTOKEN,this.node=t,this.d=n.rsI,this.bo=null!=e.def.bo,this.ao=null!=e.def.ao,this.bc=null!=e.def.bc,this.ac=null!=e.def.ac}process(e){return this.spec.process(this,e,this.state)}}const u=(...e)=>new p(...e);o.makeRule=u;class d{constructor(){this.p=r.EMPTY,this.r=r.EMPTY,this.b=0}}const m=(...e)=>new d(...e),f=m(),h=m();class x{constructor(e,n){this.name=r.EMPTY,this.cfg=e,this.def=n||{},this.def.open=(this.def.open||[]).filter(e=>null!=e),this.def.close=(this.def.close||[]).filter(e=>null!=e);for(let t of[...this.def.open,...this.def.close])(0,a.normalt)(t)}tin(e){return(0,a.tokenize)(e,this.cfg)}add(e,n,t){let r=(null==t?void 0:t.last)?"push":"unshift",i=((0,a.isarr)(n)?n:[n]).filter(e=>null!=e).map(e=>(0,a.normalt)(e));return this.def["o"===e?"open":"close"][r](...i),(0,a.filterRules)(this,this.cfg),this}open(e,n){return this.add("o",e,n)}close(e,n){return this.add("c",e,n)}action(e,n,t){return this.def[e+n]=t,this}bo(e){return this.action(r.BEFORE,r.OPEN,e)}ao(e){return this.action(r.AFTER,r.OPEN,e)}bc(e){return this.action(r.BEFORE,r.CLOSE,e)}ac(e){return this.action(r.AFTER,r.CLOSE,e)}clear(){return this.def={open:[],close:[]},this}process(e,n,t){let i=r.EMPTY,l=n.F,s="o"===t,o=s?e:n.NORULE,c=this.def,p=s?c.open:c.close,d=s?e.bo&&c.bo:e.bc&&c.bc,m=d&&d.call(this,e,n);if(m&&m.isToken&&null!=m.err)return this.bad(m,e,n,{is_open:s});let f=0<p.length?this.parse_alts(s,p,e,n):h;if(f.h&&(f=f.h(e,n,f,o)||f,i+="H"),f.e)return this.bad(f.e,e,n,{is_open:s});if(f.n)for(let r in f.n)e.n[r]=0===f.n[r]?0:(null==e.n[r]?0:e.n[r])+f.n[r];if(f.u&&(e.use=Object.assign(e.use,f.u)),f.a){i+="A";let t=f.a.call(this,e,n,f);if(t&&t.isToken&&t.err)return this.bad(t,e,n,{is_open:s})}if(f.p){n.rs[n.rsI++]=e;let t=n.rsm[f.p];if(!t)return this.bad(this.unknownRule(n.t0,f.p),e,n,{is_open:s});(o=e.child=u(t,n,e.node)).parent=e,o.n={...e.n},i+="@p:"+f.p}else if(f.r){let t=n.rsm[f.r];if(!t)return this.bad(this.unknownRule(n.t0,f.r),e,n,{is_open:s});(o=u(t,n,e.node)).parent=e.parent,o.prev=e,o.n={...e.n},i+="@r:"+f.r}else s||(o=n.rs[--n.rsI]||n.NORULE),i+="Z";let x=s?e.ao&&c.ao:e.ac&&c.ac,g=x&&x.call(this,e,n,f,o);if(g&&g.isToken&&null!=g.err)return this.bad(g,e,n,{is_open:s});o.why=i,n.log&&n.log("node  "+e.state.toUpperCase(),e.prev.id+"/"+e.parent.id+"/"+e.child.id,e.name+"~"+e.id,"w="+i,"n:"+(0,a.entries)(e.n).filter(e=>e[1]).map(e=>e[0]+"="+e[1]).join(";"),"u:"+(0,a.entries)(e.use).map(e=>e[0]+"="+e[1]).join(";"),"<"+l(e.node)+">");let v=0,k=e[s?"os":"cs"]-(f.b||0);for(;v++<k;)n.next();return r.OPEN===e.state&&(e.state=r.CLOSE),o}parse_alts(e,n,t,i){let l=f;l.b=0,l.p=r.EMPTY,l.r=r.EMPTY,l.n=void 0,l.h=void 0,l.a=void 0,l.u=void 0,l.e=void 0;let s,o=null,c=0,p=i.cfg.t,u=1<<p.AA-1,d=n.length;for(c=0;c<d;c++){o=n[c];let r=i.t0.tin,a=!1,p=!1;if(s=!0,o.S0&&(a=!0,(s=o.S0[r/31|0]&(1<<r%31-1|u))&&(p=null!=o.S1,o.S1))){p=!0;let e=i.t1.tin;s=o.S1[e/31|0]&(1<<e%31-1|u)}if(e?(t.o0=a?i.t0:i.NOTOKEN,t.o1=p?i.t1:i.NOTOKEN,t.os=(a?1:0)+(p?1:0)):(t.c0=a?i.t0:i.NOTOKEN,t.c1=p?i.t1:i.NOTOKEN,t.cs=(a?1:0)+(p?1:0)),s&&o.c&&(s=s&&o.c(t,i,l)),s)break;o=null}s||p.ZZ===i.t0.tin||(l.e=i.t0),o&&(l.n=null!=o.n?o.n:l.n,l.h=null!=o.h?o.h:l.h,l.a=null!=o.a?o.a:l.a,l.u=null!=o.u?o.u:l.u,l.g=null!=o.g?o.g:l.g,l.e=o.e&&o.e(t,i,l)||void 0,l.p=null!=o.p?"string"==typeof o.p?o.p:o.p(t,i,l):l.p,l.r=null!=o.r?"string"==typeof o.r?o.r:o.r(t,i,l):l.r,l.b=null!=o.b?"number"==typeof o.b?o.b:o.b(t,i,l):l.b);let m=c<n.length;return i.log&&i.log("parse "+t.state.toUpperCase(),t.prev.id+"/"+t.parent.id+"/"+t.child.id,t.name+"~"+t.id,m?"alt="+c:"no-alt",m&&l.g?"g:"+l.g+" ":"",(m&&l.p?"p:"+l.p+" ":"")+(m&&l.r?"r:"+l.r+" ":"")+(m&&l.b?"b:"+l.b+" ":""),(r.OPEN===t.state?[t.o0,t.o1].slice(0,t.os):[t.c0,t.c1].slice(0,t.cs)).map(e=>e.name+"="+i.F(e.src)).join(" "),"c:"+(o&&o.c?s:r.EMPTY),"n:"+(0,a.entries)(l.n).map(e=>e[0]+"="+e[1]).join(";"),"u:"+(0,a.entries)(l.u).map(e=>e[0]+"="+e[1]).join(";"),c<n.length&&o.s?"["+o.s.map(e=>Array.isArray(e)?e.map(e=>p[e]).join("|"):p[e]).join(" ")+"]":"[]",l),l}bad(e,n,t,r){throw new a.JsonicError(e.err||a.S.unexpected,{...e.use,state:r.is_open?a.S.open:a.S.close},e,n,t)}unknownRule(e,n){return e.err="unknown_rule",e.use=e.use||{},e.use.rulename=n,e}}const g=(...e)=>new x(...e);o.makeRuleSpec=g;class v{constructor(e,n){this.rsm={},this.options=e,this.cfg=n}rule(e,n){if(null==e)return this.rsm;let t=this.rsm[e];if(null===n)delete this.rsm[e];else if(void 0!==n){t=this.rsm[e]=this.rsm[e]||g(this.cfg,{}),(t=this.rsm[e]=n(this.rsm[e],this.rsm)||this.rsm[e]).name=e;for(let e of[...t.def.open,...t.def.close])(0,a.normalt)(e);return}return t}start(e,n,t,i){let l,s=(0,c.makeToken)("#ZZ",(0,a.tokenize)("#ZZ",this.cfg),void 0,r.EMPTY,(0,c.makePoint)(-1)),o=(0,c.makeNoToken)(),p={uI:0,opts:this.options,cfg:this.cfg,meta:t||{},src:()=>e,root:()=>l.node,plgn:()=>n.internal().plugins,rule:{},xs:-1,v2:s,v1:s,t0:s,t1:s,tC:-2,next:b,rs:[],rsI:0,rsm:this.rsm,log:void 0,F:(0,a.srcfmt)(this.cfg),use:{},NOTOKEN:o,NORULE:{}},d=(e=>u(g(e.cfg,{}),e))(p=(0,a.deep)(p,i));if(p.NORULE=d,p.rule=d,(0,a.makelog)(p,t),""===e){if(this.cfg.lex.empty)return;throw new a.JsonicError(a.S.unexpected,{src:e},p.t0,d,p)}let m=e=>(0,a.tokenize)(e,this.cfg),f=(0,a.badlex)((0,c.makeLex)(p),(0,a.tokenize)("#BD",this.cfg),p),h=this.rsm[this.cfg.rule.start];if(null==h)return;let x=u(h,p);l=x;let v=2*(0,a.keys)(this.rsm).length*f.src.length*2*p.cfg.rule.maxmul,k=p.cfg.tokenSet.ignore;function b(){let e;p.v2=p.v1,p.v1=p.t0,p.t0=p.t1;do{e=f(x),p.tC++}while(k[e.tin]);return p.t1=e,p.t0}b(),b();let y=0;for(;d!==x&&y<v;)p.log&&p.log("\nstack","<<"+p.F(l.node)+">>",p.rs.slice(0,p.rsI).map(e=>e.name+"~"+e.id).join("/"),p.rs.slice(0,p.rsI).map(e=>"<"+p.F(e.node)+">").join(" "),x,p,"\n"),p.log&&p.log("rule  "+x.state.toUpperCase(),x.prev.id+"/"+x.parent.id+"/"+x.child.id,x.name+"~"+x.id,"["+p.F(p.t0.src)+" "+p.F(p.t1.src)+"]","n:"+(0,a.entries)(x.n).filter(e=>e[1]).map(e=>e[0]+"="+e[1]).join(";"),"u:"+(0,a.entries)(x.use).map(e=>e[0]+"="+e[1]).join(";"),"["+m(p.t0.tin)+" "+m(p.t1.tin)+"]",x,p),p.rule=x,x=x.process(p),y++;if((0,a.tokenize)("#ZZ",this.cfg)!==p.t0.tin)throw new a.JsonicError(a.S.unexpected,{},p.t0,d,p);return p.root()}clone(e,n){let t=new v(e,n);return t.rsm=Object.keys(this.rsm).reduce((e,n)=>(e[n]=(0,a.filterRules)(this.rsm[n],this.cfg),e),{}),t}}o.Parser=v;var k={};Object.defineProperty(k,"__esModule",{value:!0}),k.grammar=void 0,k.grammar=function(e){const n=e.token.OB,t=e.token.CB,r=e.token.OS,i=e.token.CS,l=e.token.CL,s=e.token.CA,o=e.token.TX,a=e.token.NR,c=e.token.ST,p=e.token.VL,u=e.token.ZZ,d=[o,a,c,p],m=e.util.deep,f=(e,n)=>{if(!n.cfg.rule.finish)return n.t0.src="END_OF_SOURCE",n.t0};e.rule("val",e=>{e.bo(e=>e.node=void 0).open([{s:[n],p:"map",b:1,g:"map,json"},{s:[r],p:"list",b:1,g:"list,json"},{s:[d,l],p:"map",b:2,n:{pk:1},g:"pair,json"},{s:[d],g:"val,json"},{s:[[t,i]],b:1,g:"val,imp,null"},{s:[s],c:{n:{il:0}},p:"list",b:1,g:"list,imp"},{s:[s],b:1,g:"list,val,imp,null"}]).close([{s:[u],g:"end"},{s:[[t,i]],b:1,g:"val,json,close"},{s:[s],c:{n:{il:0,pk:0}},n:{il:1},r:"elem",a:e=>e.node=[e.node],g:"list,val,imp,comma"},{c:{n:{il:0,pk:0}},n:{il:1},r:"elem",a:e=>e.node=[e.node],g:"list,val,imp,space",b:1},{b:1,g:"val,json,more"}]).bc((e,n)=>{e.node=void 0===e.node?void 0===e.child.node?0===e.os?void 0:e.o0.resolveVal(e,n):e.child.node:e.node})}),e.rule("map",e=>{e.bo(e=>{e.n.il=1+(e.n.il?e.n.il:0),e.n.im=1+(e.n.im?e.n.im:0),e.node={}}).open([{s:[n,t],g:"map,json"},{s:[n],p:"pair",n:{pk:0},g:"map,json,pair"},{s:[d,l],p:"pair",b:2,g:"pair,list,val,imp"}])}),e.rule("list",e=>{e.bo(e=>{e.n.il=1+(e.n.il?e.n.il:0),e.n.pk=1+(e.n.pk?e.n.pk:0),e.n.im=1+(e.n.im?e.n.im:0),e.node=[]}).open([{s:[r,i],g:"list,json"},{s:[r],p:"elem",g:"list,json,elem"},{s:[s],p:"elem",b:1,g:"list,elem,val,imp"},{p:"elem",g:"list,elem"}])}),e.rule("pair",e=>{e.open([{s:[d,l],p:"val",u:{key:!0},g:"map,pair,key,json"},{s:[s],g:"map,pair,comma"}]).bc((e,n)=>{if(e.use.key){const t=e.o0,r=c===t.tin||o===t.tin?t.val:t.src;let i=e.child.node;const l=e.node[r];i=void 0===i?null:i,e.node[r]=null==l?i:n.cfg.map.merge?n.cfg.map.merge(l,i):n.cfg.map.extend?m(l,i):i}}).close([{s:[t],c:{n:{pk:0}},g:"map,pair,json"},{s:[s,t],c:{n:{pk:0}},g:"map,pair,comma"},{s:[s],c:{n:{pk:0}},r:"pair",g:"map,pair,json"},{s:[s],c:{n:{im:1}},r:"pair",g:"map,pair,json"},{s:[d],c:{n:{pk:0}},r:"pair",b:1,g:"map,pair,imp"},{s:[d],c:{n:{im:1}},r:"pair",b:1,g:"map,pair,imp"},{s:[[t,s,...d]],b:1,g:"map,pair,imp,path"},{s:[i],b:1,g:"list,pair,imp"},{s:[u],e:f,g:"map,pair,json"}])}),e.rule("elem",e=>{e.open([{s:[s,s],b:2,a:e=>e.node.push(null),g:"list,elem,imp,null"},{s:[s],a:e=>e.node.push(null),g:"list,elem,imp,null"},{p:"val",g:"list,elem,val,json"}]).bc(e=>{void 0!==e.child.node&&e.node.push(e.child.node)}).close([{s:[s,i],g:"list,elem,comma"},{s:[s],r:"elem",g:"list,elem,json"},{s:[[...d,n,r]],r:"elem",b:1,g:"list,elem,imp"},{s:[i],g:"list,elem,json"},{s:[u],e:f,g:"list,elem,json"}])})};var b={exports:{}};Object.defineProperty(b.exports,"__esModule",{value:!0}),b.exports.AFTER=b.exports.BEFORE=b.exports.CLOSE=b.exports.OPEN=b.exports.makeTextMatcher=b.exports.makeNumberMatcher=b.exports.makeCommentMatcher=b.exports.makeStringMatcher=b.exports.makeLineMatcher=b.exports.makeSpaceMatcher=b.exports.makeFixedMatcher=b.exports.makeLex=b.exports.makeRuleSpec=b.exports.makeRule=b.exports.makePoint=b.exports.makeToken=b.exports.make=b.exports.util=b.exports.Parser=b.exports.JsonicError=b.exports.Jsonic=void 0,Object.defineProperty(b.exports,"OPEN",{enumerable:!0,get:function(){return r.OPEN}}),Object.defineProperty(b.exports,"CLOSE",{enumerable:!0,get:function(){return r.CLOSE}}),Object.defineProperty(b.exports,"BEFORE",{enumerable:!0,get:function(){return r.BEFORE}}),Object.defineProperty(b.exports,"AFTER",{enumerable:!0,get:function(){return r.AFTER}});const y=n({});Object.defineProperty(b.exports,"JsonicError",{enumerable:!0,get:function(){return y.JsonicError}});const _=t({});Object.defineProperty(b.exports,"makePoint",{enumerable:!0,get:function(){return _.makePoint}}),Object.defineProperty(b.exports,"makeToken",{enumerable:!0,get:function(){return _.makeToken}}),Object.defineProperty(b.exports,"makeLex",{enumerable:!0,get:function(){return _.makeLex}}),Object.defineProperty(b.exports,"makeFixedMatcher",{enumerable:!0,get:function(){return _.makeFixedMatcher}}),Object.defineProperty(b.exports,"makeSpaceMatcher",{enumerable:!0,get:function(){return _.makeSpaceMatcher}}),Object.defineProperty(b.exports,"makeLineMatcher",{enumerable:!0,get:function(){return _.makeLineMatcher}}),Object.defineProperty(b.exports,"makeStringMatcher",{enumerable:!0,get:function(){return _.makeStringMatcher}}),Object.defineProperty(b.exports,"makeCommentMatcher",{enumerable:!0,get:function(){return _.makeCommentMatcher}}),Object.defineProperty(b.exports,"makeNumberMatcher",{enumerable:!0,get:function(){return _.makeNumberMatcher}}),Object.defineProperty(b.exports,"makeTextMatcher",{enumerable:!0,get:function(){return _.makeTextMatcher}}),Object.defineProperty(b.exports,"makeRule",{enumerable:!0,get:function(){return o.makeRule}}),Object.defineProperty(b.exports,"makeRuleSpec",{enumerable:!0,get:function(){return o.makeRuleSpec}}),Object.defineProperty(b.exports,"Parser",{enumerable:!0,get:function(){return o.Parser}});const E={tokenize:y.tokenize,srcfmt:y.srcfmt,deep:y.deep,clone:y.clone,charset:y.charset,trimstk:y.trimstk,makelog:y.makelog,badlex:y.badlex,extract:y.extract,errinject:y.errinject,errdesc:y.errdesc,configure:y.configure,parserwrap:y.parserwrap,mesc:y.mesc,escre:y.escre,regexp:y.regexp,prop:y.prop,str:y.str,omap:y.omap,keys:y.keys,values:y.values,entries:y.entries};function I(e,n){let t={parser:{},config:{},plugins:[],mark:Math.random()},r=(0,y.deep)({},n?{...n.options}:!1===(null==e?void 0:e.defaults$)?{}:i.defaults,e||{}),l=function(e,n,t){var r;if(y.S.string===typeof e){let i=l.internal();return((null===(r=s.parser)||void 0===r?void 0:r.start)?(0,y.parserwrap)(s.parser):i.parser).start(e,l,n,t)}return e},s=e=>{if(null!=e&&y.S.object===typeof e){(0,y.deep)(r,e),(0,y.configure)(l,t.config,r);let n=l.internal().parser;t.parser=n.clone(r,t.config)}return{...l.options}},a={token:e=>(0,y.tokenize)(e,t.config,l),fixed:e=>t.config.fixed.ref[e],options:(0,y.deep)(s,r),parse:l,use:function(e,n){const t=e.name.toLowerCase(),r=(0,y.deep)({},e.defaults||{},n||{});l.options({plugin:{[t]:r}});let i=l.options.plugin[t];return l.internal().plugins.push(e),e(l,i)||l},rule:(e,n)=>l.internal().parser.rule(e,n)||l,lex:e=>{let n=r.lex.match;n.unshift(e),l.options({lex:{match:n}})},make:e=>I(e,l),empty:e=>I({defaults$:!1,grammar$:!1,...e||{}}),id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+(null==s.tag?"":"/"+s.tag),toString:()=>a.id,util:E};if((0,y.defprop)(a.make,y.S.name,{value:y.S.make}),(0,y.assign)(l,a),(0,y.defprop)(l,"internal",{value:()=>t}),n){for(let t in n)void 0===l[t]&&(l[t]=n[t]);l.parent=n;let e=n.internal();t.config=(0,y.deep)({},e.config),(0,y.configure)(l,t.config,r),(0,y.assign)(l.token,t.config.t),t.plugins=[...e.plugins],t.parser=e.parser.clone(r,t.config)}else t.config=(0,y.configure)(l,void 0,r),t.plugins=[],t.parser=new o.Parser(r,t.config),!1!==r.grammar$&&(0,k.grammar)(l);return l}b.exports.util=E,b.exports.make=I;let M=void 0,O=M=I();return b.exports.Jsonic=O,delete M.options,delete M.use,delete M.rule,delete M.lex,delete M.token,delete M.fixed,M.Jsonic=M,M.JsonicError=y.JsonicError,M.Parser=o.Parser,M.makeLex=_.makeLex,M.makeToken=_.makeToken,M.makePoint=_.makePoint,M.makeRule=o.makeRule,M.makeRuleSpec=o.makeRuleSpec,M.makeFixedMatcher=_.makeFixedMatcher,M.makeSpaceMatcher=_.makeSpaceMatcher,M.makeLineMatcher=_.makeLineMatcher,M.makeStringMatcher=_.makeStringMatcher,M.makeCommentMatcher=_.makeCommentMatcher,M.makeNumberMatcher=_.makeNumberMatcher,M.makeTextMatcher=_.makeTextMatcher,M.util=E,M.make=I,b.exports.default=O,b.exports=b.exports.Jsonic,b.exports}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),e=e.exports;var n={};Object.defineProperty(n,"__esModule",{value:!0}),n.testing=n.evaluate=n.Expr=void 0;const{omap:t,entries:r,values:i}=e.util,l={};let s=function(e,n){var s;let y=(null===(s=e.options.lex)||void 0===s?void 0:s.match)||[],_=y.map(e=>e.name).indexOf("makeCommentMatcher");0<_&&e.options({lex:{match:[y[_],...y.slice(0,_),...y.slice(_+1)]}});let E=e.token.bind(e),I=e.fixed.bind(e),M=n.op||{};const O=v(E,I,M,"prefix"),S=v(E,I,M,"suffix"),T=v(E,I,M,"infix"),j=v(E,I,M,"ternary"),P=function(e,n,t){return r(t).reduce((t,[r,i])=>{if(i.paren){let s=n(i.osrc)||e("#E"+i.osrc),o=e(s),a=n(i.csrc)||e("#E"+i.csrc),c=e(a);t[s]={name:r+"-paren",osrc:i.osrc,csrc:i.csrc,otkn:o,otin:s,ctkn:c,ctin:a,preval:{active:null!=i.preval&&(null==i.preval.active||i.preval.active),required:null!=i.preval&&null!=i.preval.required&&i.preval.required},use:{},paren:!0,src:i.osrc,left:Number.MIN_SAFE_INTEGER,right:Number.MAX_SAFE_INTEGER,infix:!1,prefix:!1,suffix:!1,ternary:!1,tkn:"",tin:-1,terms:1,token:{},OP_MARK:l}}return t},{})}(E,I,M),N=t(P,([e,n])=>[void 0,void 0,n.ctin,n]);let C=Object.values({...P,...N}).reduce((e,n)=>(e[n.otkn]=n.osrc,e[n.ctkn]=n.csrc,e),{}),w=Object.values({...O,...S,...T,...j}).reduce((e,n)=>(e[n.tkn]=n.src,e),{});e.options({fixed:{token:{...w,...C}}});const R=i(O).map(e=>e.tin),A=i(T).map(e=>e.tin),L=i(S).map(e=>e.tin),F=i(j).filter(e=>0===e.use.ternary.opI).map(e=>e.tin),Y=i(j).filter(e=>1===e.use.ternary.opI).map(e=>e.tin),U=i(P).map(e=>e.otin),$=i(N).map(e=>e.ctin),J=0<R.length,B=0<A.length,K=0<L.length,Z=0<F.length&&0<Y.length,z=0<U.length&&0<$.length,D=e.token.CA,V=e.token.TX,q=e.token.NR,G=e.token.ST,W=e.token.VL,H=e.token.ZZ,X=[V,q,G,W];e.rule("val",n=>{Z&&Y.includes(e.token.CL)&&(n.def.open.find(e=>e.g.includes("pair")).c=e=>!e.n.expr_ternary),n.open([J?{s:[R],b:1,n:{expr_prefix:1,expr_suffix:0},p:"expr",g:"expr,expr-prefix"}:null,z?{s:[U],b:1,p:"paren",c:(e,n)=>{let t=!0;return P[e.o0.tin].preval.required&&(t="val"===e.prev.name&&e.prev.use.paren_preval),t&&1===e.prev.id&&(n.root=()=>e.node),t},g:"expr,expr-paren"}:null]).close([Z?{s:[F],c:e=>!e.n.expr,b:1,r:"ternary",g:"expr,expr-ternary"}:null,B?{s:[A],b:1,n:{expr_prefix:0,expr_suffix:0},r:e=>e.n.expr?"":"expr",g:"expr,expr-infix"}:null,K?{s:[L],b:1,n:{expr_prefix:0,expr_suffix:1},r:e=>e.n.expr?"":"expr",g:"expr,expr-suffix"}:null,z?{s:[$],c:e=>!!e.n.expr_paren,b:1,g:"expr,expr-paren"}:null,z?{s:[U],b:1,r:"val",c:e=>P[e.c0.tin].preval.active,u:{paren_preval:!0},g:"expr,expr-paren,expr-paren-preval"}:null,Z?{s:[Y],c:e=>!!e.n.expr_ternary,b:1,g:"expr,expr-ternary"}:null,{s:[D],c:e=>1===e.d&&(1<=e.n.expr||1<=e.n.expr_ternary)||1<=e.n.expr_ternary&&1<=e.n.expr_paren,b:1,g:"expr,list,val,imp,comma,top"},{s:[X],c:e=>1===e.d&&(1<=e.n.expr||1<=e.n.expr_ternary)||1<=e.n.expr_ternary&&1<=e.n.expr_paren,b:1,g:"expr,list,val,imp,space,top"}])}),e.rule("list",e=>{let n=e.def.bo;e.bo((...e)=>{n(...e),e[0].n.expr=0,e[0].n.expr_prefix=0,e[0].n.expr_suffix=0,e[0].n.expr_paren=0,e[0].n.expr_ternary=0})}),e.rule("map",e=>{let n=e.def.bo;e.bo((...e)=>{n(...e),e[0].n.expr=0,e[0].n.expr_prefix=0,e[0].n.expr_suffix=0,e[0].n.expr_paren=0,e[0].n.expr_ternary=0})}),e.rule("elem",e=>{e.close([z?{s:[$],b:1,c:e=>!!e.n.expr_paren,g:"expr,expr-paren,imp,close,list"}:null,z?{s:[U],b:1,r:"elem",g:"expr,expr-paren,imp,open,list"}:null])}),e.rule("pair",e=>{e.close([z?{s:[$],b:1,c:e=>!!e.n.expr_paren||0<e.n.pk,g:"expr,expr-paren,imp,map"}:null])}),e.rule("expr",e=>{e.open([J?{s:[R],c:e=>!!e.n.expr_prefix,n:{expr:1,il:1,im:1},p:"val",g:"expr,expr-prefix",a:e=>{const n=a(e.o0,O);e.node=g(e.parent.node)?k(e.parent.node,n):o(e,e.parent,n)}}:null,B?{s:[A],p:"val",n:{expr:1,expr_prefix:0,il:1,im:1},a:e=>{const n=e.prev,t=e.parent,r=a(e.o0,T);g(t.node)&&!x("ternary",t.node)?e.node=k(t.node,r):g(n.node)?(e.node=k(n.node,r),e.parent=n):e.node=o(e,n,r)},g:"expr,expr-infix"}:null,K?{s:[L],n:{expr:1,expr_prefix:0,il:1,im:1},a:e=>{const n=e.prev,t=a(e.o0,S);e.node=g(n.node)?k(n.node,t):o(e,n,t)},g:"expr,expr-suffix"}:null]).bc(e=>{var n;g(e.node)&&(null===(n=e.node)||void 0===n?void 0:n.length)-1<e.node[0].terms&&e.node.push(e.child.node)}).close([B?{s:[A],c:e=>!e.n.expr_prefix,b:1,r:"expr",g:"expr,expr-infix"}:null,K?{s:[L],c:e=>!e.n.expr_prefix,b:1,r:"expr",g:"expr,expr-suffix"}:null,z?{s:[$],c:e=>!!e.n.expr_paren,b:1}:null,Z?{s:[F],c:e=>!e.n.expr_prefix,b:1,r:"ternary",g:"expr,expr-ternary"}:null,{s:[D],c:{d:0},n:{expr:0},r:"elem",a:e=>e.parent.node=e.node=[e.node],g:"expr,comma,list,top"},{s:[X],c:{d:0},n:{expr:0},b:1,r:"elem",a:e=>e.parent.node=e.node=[e.node],g:"expr,space,list,top"},{s:[D],c:{n:{pk:0}},n:{expr:0},b:1,h:m,g:"expr,list,val,imp,comma"},{c:{n:{pk:0,expr_suffix:0}},n:{expr:0},h:m,g:"expr,list,val,imp,space"},{n:{expr:0},g:"expr,expr-end"}]).ac(e=>{n.evaluate&&0===e.n.expr&&(e.parent.node=b(e.parent.node,n.evaluate))})}),e.rule("paren",e=>{e.bo(e=>{e.n.im=0,e.n.il=0,e.n.pk=0}).open([z?{s:[U,$],b:1,g:"expr,expr-paren,empty",c:e=>P[e.o0.tin].name===N[e.o1.tin].name,a:u(P)}:null,z?{s:[U],p:"val",n:{expr_paren:1,expr:0,expr_prefix:0,expr_suffix:0},g:"expr,expr-paren,open",a:u(P)}:null]).close([z?{s:[$],c:e=>{let n="expr_paren_depth_"+N[e.c0.tin].name;return!!e.n[n]},a:d(N),g:"expr,expr-paren,close"}:null])}),Z&&e.rule("ternary",e=>{e.open([{s:[F],p:"val",n:{expr_ternary:1,expr:0,expr_prefix:0,expr_suffix:0},u:{expr_ternary_step:1},g:"expr,expr-ternary,open",a:e=>{let n=a(e.o0,j);e.use.expr_ternary_name=n.name,g(e.prev.node)?e.node=c(e.prev.node,n,p(e.prev.node)):e.node=e.prev.node=c([],n,e.prev.node),e.use.expr_ternary_paren=e.n.expr_paren||e.prev.use.expr_ternary_paren||0,e.n.expr_paren=0}},{p:"val",c:e=>2===e.prev.use.expr_ternary_step,a:e=>{e.use.expr_ternary_step=e.prev.use.expr_ternary_step,e.n.expr_paren=e.use.expr_ternary_paren=e.prev.use.expr_ternary_paren},g:"expr,expr-ternary,step"}]).close([{s:[Y],c:e=>1===e.use.expr_ternary_step&&e.use.expr_ternary_name===j[e.c0.tin].name,r:"ternary",a:e=>{e.use.expr_ternary_step++,e.node.push(e.child.node)},g:"expr,expr-ternary,step"},{s:[[D,...$]],c:f,b:(e,n)=>$.includes(n.t0.tin)?1:0,r:(e,n)=>{var t;return $.includes(n.t0.tin)||0!==e.d&&(!e.prev.use.expr_ternary_paren||(null===(t=e.parent.node)||void 0===t?void 0:t.length))?"":"elem"},a:h,g:"expr,expr-ternary,list,val,imp,comma"},{c:f,r:(e,n)=>{var t;return 0!==e.d&&$.includes(n.t0.tin)&&!e.prev.use.expr_ternary_paren||(null===(t=e.parent.node)||void 0===t?void 0:t.length)||H===n.t0.tin?"":"elem"},a:h,g:"expr,expr-ternary,list,val,imp,space"},{c:e=>0<e.d&&2===e.use.expr_ternary_step,a:e=>{e.node.push(e.child.node)},g:"expr,expr-ternary,close"}])})};function o(e,n,t){let r=n.node;return g(n.node)?r=p(n.node):n.node=[],c(n.node,t),t.prefix||(n.node[1]=r),e.parent=n,n.node}function a(e,n){return{...n[e.tin],token:e,OP_MARK:l}}function c(e,n,...t){let r=e;r[0]=n;let i=0;for(;i<t.length;i++)r[i+1]=t[i];return r.length=i+1,r}function p(e){return[...e]}function u(e){return function(n){let t="expr_paren_depth_"+a(n.o0,e).name;n.use[t]=n.n[t]=1,n.node=void 0}}function d(e){return function(n){(g(n.child.node)||void 0===n.node)&&(n.node=n.child.node);const t=a(n.c0,e);let r="expr_paren_depth_"+t.name;if(n.use[r]===n.n[r]){const e=n.node;n.node=[t],void 0!==e&&(n.node[1]=e),n.parent.prev.use.paren_preval&&(x("paren",n.parent.prev.node)?n.node=c(n.parent.prev.node,n.node[0],p(n.parent.prev.node),n.node[1]):(n.node.splice(1,0,n.parent.prev.node),n.parent.prev.node=n.node))}}}function m(e,n,t){let r=null;for(let i=n.rsI-1;-1<i;i--)if("paren"===n.rs[i].name){r=n.rs[i];break}return r&&(null==r.child.node?(r.child.node=[e.node],t.r="elem",t.b=0):g(r.child.node)&&(r.child.node=[r.child.node],t.r="elem",t.b=0),e.node=r.child.node),t}function f(e){return(0===e.d||1<=e.n.expr_paren)&&!e.n.pk&&2===e.use.expr_ternary_step}function h(e,n,t){e.n.expr_paren=e.prev.use.expr_ternary_paren,e.node.push(e.child.node),"elem"===t.r&&(e.node[0]=p(e.node),e.node.length=1)}function x(e,n){return null!=n&&g(n)&&!0===n[0][e]}function g(e){return null!=e&&e[0]&&e[0].OP_MARK===l}function v(e,n,t,r){return Object.entries(t).filter(([e,n])=>n[r]).reduce((t,[i,s])=>{let o="",a=-1,c="";c="string"==typeof s.src?s.src:s.src[0],a=n(c)||e("#E"+c),o=e(a);let p=t[a]={src:c,left:s.left||Number.MIN_SAFE_INTEGER,right:s.right||Number.MAX_SAFE_INTEGER,name:i+(i.endsWith("-"+r)?"":"-"+r),infix:"infix"===r,prefix:"prefix"===r,suffix:"suffix"===r,ternary:"ternary"===r,tkn:o,tin:a,terms:"ternary"===r?3:"infix"===r?2:1,use:{},paren:!1,osrc:"",csrc:"",otkn:"",ctkn:"",otin:-1,ctin:-1,preval:{active:!1,required:!1},token:{},OP_MARK:l};if(p.ternary){let r=s.src;p.src=r[0],p.use.ternary={opI:0};let i={...p};c=s.src[1],a=n(c)||e("#E"+c),o=e(a),i.src=c,i.use={ternary:{opI:1}},i.tkn=o,i.tin=a,t[a]=i}return t},{})}function k(e,n){let t=e,r=e[0];if(n)if(n.infix)if(r.suffix||n.left<=r.right)c(e,n,p(e));else{const i=r.terms;t=g(e[i])&&e[i][0].right<n.left?k(e[i],n):e[i]=c([],n,e[i])}else if(n.prefix)t=e[r.terms]=c([],n);else if(n.suffix)if(!r.suffix&&r.right<=n.left){const t=r.terms;g(e[t])&&e[t][0].prefix&&e[t][0].right<n.left?k(e[t],n):e[t]=c([],n,e[t])}else c(e,n,p(e));return t}function b(e,n){return null==e?e:g(e)?n(e[0],e.slice(1).map(e=>b(e,n))):e}n.Expr=s,s.defaults={op:{positive:{prefix:!0,right:14e3,src:"+"},negative:{prefix:!0,right:14e3,src:"-"},addition:{infix:!0,left:140,right:150,src:"+"},subtraction:{infix:!0,left:140,right:150,src:"-"},multiplication:{infix:!0,left:160,right:170,src:"*"},division:{infix:!0,left:160,right:170,src:"/"},remainder:{infix:!0,left:160,right:170,src:"%"},plain:{paren:!0,osrc:"(",csrc:")"}}},n.evaluate=b;const y={prattify:k,opify:e=>(e.OP_MARK=l,e)};return n.testing=y,n}));