!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JsonicExpr=e()}}((function(){var e={exports:{}};(function(n){(function(){!function(t){"object"==typeof e.exports?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).Jsonic=t()}((function(){var e=function(e){var n;return function(t){return n||e(n={exports:{},parent:t},n.exports),n.exports}},n=e((function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.modlist=n.findTokenSet=n.log_lex=n.log_stack=n.log_parse=n.log_node=n.log_rule=n.values=n.keys=n.omap=n.str=n.prop=n.parserwrap=n.trimstk=n.tokenize=n.srcfmt=n.snip=n.regexp=n.mesc=n.makelog=n.isarr=n.filterRules=n.extract=n.escre=n.errinject=n.errdesc=n.entries=n.defprop=n.deep=n.configure=n.clone=n.clean=n.charset=n.badlex=n.assign=n.S=n.JsonicError=void 0;const l=t({}),i=e=>null==e?[]:Object.keys(e);n.keys=i;const o=e=>null==e?[]:Object.values(e);n.values=o;const s=e=>null==e?[]:Object.entries(e);n.entries=s;const a=(e,...n)=>Object.assign(null==e?{}:e,...n);n.assign=a,n.isarr=e=>Array.isArray(e);const u=Object.defineProperty;n.defprop=u;const c=(e,n)=>Object.entries(e||{}).reduce((e,t)=>{let r=n?n(t):t;void 0===r[0]?delete e[t[0]]:e[r[0]]=r[1];let l=2;for(;void 0!==r[l];)e[r[l]]=r[l+1],l+=2;return e},{});n.omap=c;const p={indent:". ",logindent:"  ",space:" ",gap:"  ",Object:"Object",Array:"Array",object:"object",string:"string",function:"function",unexpected:"unexpected",map:"map",list:"list",elem:"elem",pair:"pair",val:"val",node:"node",no_re_flags:r.EMPTY,unprintable:"unprintable",invalid_ascii:"invalid_ascii",invalid_unicode:"invalid_unicode",invalid_lex_state:"invalid_lex_state",unterminated_string:"unterminated_string",unterminated_comment:"unterminated_comment",lex:"lex",parse:"parse",error:"error",none:"none",imp_map:"imp,map",imp_list:"imp,list",imp_null:"imp,null",end:"end",open:"open",close:"close",rule:"rule",stack:"stack",nUll:"null",name:"name",make:"make",colon:":"};n.S=p;class d extends SyntaxError{constructor(e,n,t,r,l){let i=b(e,n=g({},n),t,r,l);super(i.message),a(this,i),v(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}function m(e,n,t){let l=n.t,i=l[e];return null==i&&r.STRING===typeof e&&(i=n.tI++,l[i]=e,l[e]=i,l[e.substring(1)]=i,null!=t&&a(t.token,n.t)),i}function f(e,...n){return new RegExp(n.map(e=>e.esc?h(e.toString()):e).join(r.EMPTY),null==e?"":e)}function h(e){return null==e?"":e.replace(/[-\\|\]{}()[^$+*?.!=]/g,"\\$&").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function g(e,...n){let t=p.function===typeof e,r=null!=e&&(p.object===typeof e||t);for(let l of n){let n,i=p.function===typeof l,o=null!=l&&(p.object===typeof l||i);if(r&&o&&!i&&Array.isArray(e)===Array.isArray(l))for(let t in l)e[t]=g(e[t],l[t]);else e=void 0===l?e:i?l:o?p.function===typeof(n=l.constructor)&&p.Object!==n.name&&p.Array!==n.name?l:g(Array.isArray(l)?[]:{},l):l,t=p.function===typeof e,r=null!=e&&(p.object===typeof e||t)}return e}function x(e,n,t,r,l,i){let o={code:n,details:t,token:r,rule:l,ctx:i};return null==e?"":e.replace(/\$([\w_]+)/g,(e,n)=>{let s=JSON.stringify(null!=o[n]?o[n]:null!=t[n]?t[n]:i.meta&&null!=i.meta[n]?i.meta[n]:null!=r[n]?r[n]:null!=l[n]?l[n]:null!=i.opts[n]?i.opts[n]:null!=i.cfg[n]?i.cfg[n]:null!=i[n]?i[n]:"$"+n);return null==s?"":s})}function v(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function k(e,n,t){let l=0<t.sI?t.sI:0,i=0<t.rI?t.rI:1,o=0<t.cI?t.cI:1,s=null==t.src?r.EMPTY:t.src,a=e.substring(Math.max(0,l-333),l).split("\n"),u=e.substring(l,l+333).split("\n"),c=2+(r.EMPTY+(i+2)).length,p=i<3?1:i-2,d=e=>"\x1b[34m"+(r.EMPTY+p++).padStart(c," ")+" | \x1b[0m"+(null==e?r.EMPTY:e),m=a.length;return[2<m?d(a[m-3]):null,1<m?d(a[m-2]):null,d(a[m-1]+u[0])," ".repeat(c)+"   "+" ".repeat(o-1)+"\x1b[31m"+"^".repeat(s.length||1)+" "+n+"\x1b[0m",d(u[1]),d(u[2])].filter(e=>null!=e).join("\n")}function b(e,n,t,r,l){var i,o,s;try{let a=l.cfg,u=l.meta,c=x(a.error[e]||(null===(i=null==n?void 0:n.use)||void 0===i?void 0:i.err)&&(n.use.err.code||n.use.err.message)||a.error.unknown,e,n,t,r,l);p.function===typeof a.hint&&(a.hint={...a.hint(),...a.hint});let d=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+c,"  \x1b[34m--\x3e\x1b[0m "+(u&&u.fileName||"<no-file>")+":"+t.rI+":"+t.cI,k(l.src(),c,t),"",x((a.hint[e]||(null===(s=null===(o=n.use)||void 0===o?void 0:o.err)||void 0===s?void 0:s.message)||a.hint.unknown||"").trim().split("\n").map(e=>"  "+e).join("\n"),e,n,t,r,l),"","  \x1b[2mhttps://jsonic.senecajs.org\x1b[0m","  \x1b[2m--internal: rule="+r.name+"~"+r.state+"; token="+m(t.tin,l.cfg)+(null==t.why?"":"~"+t.why)+"; plugins="+l.plgn().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),f={internal:{token:t,ctx:l}};return f={...Object.create(f),message:d,code:e,details:n,meta:u,fileName:u?u.fileName:void 0,lineNumber:t.rI,columnNumber:t.cI},f}catch(a){return console.log(a),{}}}function y(e){return"function"==typeof e.debug.print.src?e.debug.print.src:n=>{let t=null==n?r.EMPTY:Array.isArray(n)?JSON.stringify(n).replace(/]$/,s(n).filter(e=>isNaN(e[0])).map((e,n)=>(0===n?", ":"")+e[0]+": "+JSON.stringify(e[1]))+"]"):JSON.stringify(n);return t=t.substring(0,e.debug.maxlen)+(e.debug.maxlen<t.length?"...":r.EMPTY),t}}function _(e,n=44){let t;try{t="object"==typeof e?JSON.stringify(e):""+e}catch(r){t=""+e}return E(n<t.length?t.substring(0,n-3)+"...":t,n)}function E(e,n=5){return void 0===e?"":(""+e).substring(0,n).replace(/[\r\n\t]/g,".")}function j(...e){return null==e?{}:e.filter(e=>!1!==e).map(e=>"object"==typeof e?i(e).join(r.EMPTY):e).join(r.EMPTY).split(r.EMPTY).reduce((e,n)=>(e[n]=n.charCodeAt(0),e),{})}function O(e){for(let n in e)null==e[n]&&delete e[n];return e}function S(e,n){return"["+(e.s||[]).map(e=>"number"==typeof e?m(e,n):Array.isArray(e)?"["+e.map(e=>m(e,n))+"]":"").join(" ")+"] "}function I(e,n,t){return e.F(e.src().substring(t.pnt.sI,t.pnt.sI+16)).padEnd(18," ")+" "+function(e){return"["+(e.NOTOKEN===e.t0?"":e.F(e.t0.src))+(e.NOTOKEN===e.t1?"":" "+e.F(e.t1.src))+"]~["+(e.NOTOKEN===e.t0?"":m(e.t0.tin,e.cfg))+(e.NOTOKEN===e.t1?"":" "+m(e.t1.tin,e.cfg))+"]"}(e).padEnd(34," ")+" "+(""+n.d).padStart(4," ")}function N(e,n){let t=s(n.n),r=s(n.use),l=s(n.keep);return(0===t.length?"":" N<"+t.filter(e=>e[1]).map(e=>e[0]+"="+e[1]).join(";")+">")+(0===r.length?"":" U<"+r.map(n=>n[0]+"="+e.F(n[1])).join(";")+">")+(0===l.length?"":" K<"+l.map(n=>n[0]+"="+e.F(n[1])).join(";")+">")}n.JsonicError=d,n.configure=function(e,n,t){var r,l,u,p,d,g,x,v,k,b,y,_,E,S,I,N,T,M,P,C,R,w,A,L,F,Y,U,$,J,K,B,D,V,G,z,Z,q,X,W,H,Q,ee;const ne=n||{};ne.t=ne.t||{},ne.tI=ne.tI||1;const te=e=>m(e,ne);!1!==t.standard$&&(te("#BD"),te("#ZZ"),te("#UK"),te("#AA"),te("#SP"),te("#LN"),te("#CM"),te("#NR"),te("#ST"),te("#TX"),te("#VL")),ne.fixed={lex:!!(null===(r=t.fixed)||void 0===r?void 0:r.lex),token:t.fixed?c(O(t.fixed.token),([e,n])=>[n,m(e,ne)]):{},ref:void 0},ne.fixed.ref=c(ne.fixed.token,([e,n])=>[e,n]),ne.fixed.ref=Object.assign(ne.fixed.ref,c(ne.fixed.ref,([e,n])=>[n,e])),ne.match={lex:!!(null===(l=t.match)||void 0===l?void 0:l.lex),value:t.match?c(O(t.match.value),([e,n])=>[e,n]):{},token:t.match?c(O(t.match.token),([e,n])=>[m(e,ne),n]):{}},c(ne.match.token,([e,n])=>[e,(n.tin$=+e,n)]);const re=t.tokenSet?Object.keys(t.tokenSet).reduce((e,n)=>(e[n]=t.tokenSet[n].filter(e=>null!=e).map(e=>te(e)),e),{}):{};ne.tokenSet=ne.tokenSet||{},s(re).map(e=>{let n=e[0],t=e[1];ne.tokenSet[n]?(ne.tokenSet[n].length=0,ne.tokenSet[n].push(...t)):ne.tokenSet[n]=t}),ne.tokenSetTins=s(ne.tokenSet).reduce((e,n)=>(e[n[0]]=e[n[0]]||{},n[1].map(t=>e[n[0]][t]=!0),e),{}),ne.tokenSetTins.IGNORE=ne.tokenSetTins.IGNORE||{},ne.space={lex:!!(null===(u=t.space)||void 0===u?void 0:u.lex),chars:j(null===(p=t.space)||void 0===p?void 0:p.chars)},ne.line={lex:!!(null===(d=t.line)||void 0===d?void 0:d.lex),chars:j(null===(g=t.line)||void 0===g?void 0:g.chars),rowChars:j(null===(x=t.line)||void 0===x?void 0:x.rowChars),single:!!(null===(v=t.line)||void 0===v?void 0:v.single)},ne.text={lex:!!(null===(k=t.text)||void 0===k?void 0:k.lex),modify:((null===(b=ne.text)||void 0===b?void 0:b.modify)||[]).concat(([null===(y=t.text)||void 0===y?void 0:y.modify]||[]).flat()).filter(e=>null!=e)},ne.number={lex:!!(null===(_=t.number)||void 0===_?void 0:_.lex),hex:!!(null===(E=t.number)||void 0===E?void 0:E.hex),oct:!!(null===(S=t.number)||void 0===S?void 0:S.oct),bin:!!(null===(I=t.number)||void 0===I?void 0:I.bin),sep:null!=(null===(N=t.number)||void 0===N?void 0:N.sep)&&""!==t.number.sep,exclude:null===(T=t.number)||void 0===T?void 0:T.exclude,sepChar:null===(M=t.number)||void 0===M?void 0:M.sep},ne.value={lex:!!(null===(P=t.value)||void 0===P?void 0:P.lex),def:s((null===(C=t.value)||void 0===C?void 0:C.def)||{}).reduce((e,n)=>(null==n[1]||!1===n[1]||n[1].match||(e[n[0]]=n[1]),e),{}),defre:s((null===(R=t.value)||void 0===R?void 0:R.def)||{}).reduce((e,n)=>(n[1]&&n[1].match&&(e[n[0]]=n[1],e[n[0]].consume=!!e[n[0]].consume),e),{})},ne.rule={start:null==(null===(w=t.rule)||void 0===w?void 0:w.start)?"val":t.rule.start,maxmul:null==(null===(A=t.rule)||void 0===A?void 0:A.maxmul)?3:t.rule.maxmul,finish:!!(null===(L=t.rule)||void 0===L?void 0:L.finish),include:(null===(F=t.rule)||void 0===F?void 0:F.include)?t.rule.include.split(/\s*,+\s*/).filter(e=>""!==e):[],exclude:(null===(Y=t.rule)||void 0===Y?void 0:Y.exclude)?t.rule.exclude.split(/\s*,+\s*/).filter(e=>""!==e):[]},ne.map={extend:!!(null===(U=t.map)||void 0===U?void 0:U.extend),merge:null===($=t.map)||void 0===$?void 0:$.merge},ne.list={property:!!(null===(J=t.list)||void 0===J?void 0:J.property)};let le=Object.keys(ne.fixed.token).sort((e,n)=>n.length-e.length).map(e=>h(e)).join("|"),ie=(null===(K=t.comment)||void 0===K?void 0:K.lex)?(t.comment.def?o(t.comment.def):[]).filter(e=>e&&e.lex).map(e=>h(e.start)).join("|"):"",oe=["([",h(i(j(ne.space.lex&&ne.space.chars,ne.line.lex&&ne.line.chars)).join("")),"]",("string"==typeof t.ender?t.ender.split(""):Array.isArray(t.ender)?t.ender:[]).map(e=>"|"+h(e)).join(""),""===le?"":"|",le,""===ie?"":"|",ie,"|$)"];return ne.rePart={fixed:le,ender:oe,commentStart:ie},ne.re={ender:f(null,...oe),rowChars:f(null,h(null===(B=t.line)||void 0===B?void 0:B.rowChars)),columns:f(null,"["+h(null===(D=t.line)||void 0===D?void 0:D.chars)+"]","(.*)$")},ne.lex={empty:!!(null===(V=t.lex)||void 0===V?void 0:V.empty),emptyResult:null===(G=t.lex)||void 0===G?void 0:G.emptyResult,match:(null===(z=t.lex)||void 0===z?void 0:z.match)?s(t.lex.match).reduce((e,n)=>{let r=n[0],l=n[1];if(l){let n=l.make(ne,t);n&&(n.matcher=r,n.make=l.make,n.order=l.order),e.push(n)}return e},[]).filter(e=>null!=e&&!1!==e&&-1<+e.order).sort((e,n)=>e.order-n.order):[]},ne.debug={get_console:(null===(Z=t.debug)||void 0===Z?void 0:Z.get_console)||(()=>console),maxlen:null==(null===(q=t.debug)||void 0===q?void 0:q.maxlen)?99:t.debug.maxlen,print:{config:!!(null===(W=null===(X=t.debug)||void 0===X?void 0:X.print)||void 0===W?void 0:W.config),src:null===(Q=null===(H=t.debug)||void 0===H?void 0:H.print)||void 0===Q?void 0:Q.src}},ne.error=t.error||{},ne.hint=t.hint||{},(null===(ee=t.config)||void 0===ee?void 0:ee.modify)&&i(t.config.modify).forEach(e=>t.config.modify[e](ne,t)),ne.debug.print.config&&ne.debug.get_console().dir(ne,{depth:null}),ne.result={fail:[]},t.result&&(ne.result.fail=[...t.result.fail]),a(e.options,t),a(e.token,ne.t),a(e.tokenSet,ne.tokenSet),a(e.fixed,ne.fixed.ref),ne},n.tokenize=m,n.findTokenSet=function(e,n){return n.tokenSet[e]},n.mesc=function(e,n){return(n=new String(e)).esc=!0,n},n.regexp=f,n.escre=h,n.deep=g,n.errinject=x,n.trimstk=v,n.extract=k,n.errdesc=b,n.badlex=function(e,n,t){let r=e.next.bind(e);return e.next=(e,l,i,o)=>{let s=r(e,l,i,o);if(n===s.tin){let n={};throw null!=s.use&&(n.use=s.use),new d(s.why||p.unexpected,n,s,e,t)}return s},e},n.makelog=function(e,n){var t,r,l;let i=null===(l=null===(r=null===(t=e.opts)||void 0===t?void 0:t.plugin)||void 0===r?void 0:r.debug)||void 0===l?void 0:l.trace;if(n||i)if("number"==typeof(null==n?void 0:n.log)||i){let t=!1,r=null==n?void 0:n.log;(-1===r||i)&&(r=1,t=!0),e.log=(...n)=>{if(t){let t=n.filter(e=>p.object!=typeof e).map(e=>p.function==typeof e?e.name:e).join(p.gap);e.cfg.debug.get_console().log(t)}else e.cfg.debug.get_console().dir(n,{depth:r})}}else"function"==typeof n.log&&(e.log=n.log);return e.log},n.srcfmt=y,n.str=_,n.snip=E,n.clone=function(e){return g(Object.create(Object.getPrototypeOf(e)),e)},n.charset=j,n.clean=O,n.filterRules=function(e,n){let t=["open","close"];for(let r of t)e.def[r]=e.def[r].map(e=>(e.g="string"==typeof e.g?(e.g||"").split(/\s*,+\s*/):e.g||[],e)).filter(e=>n.rule.include.reduce((n,t)=>n||null!=e.g&&-1!==e.g.indexOf(t),0===n.rule.include.length)).filter(e=>n.rule.exclude.reduce((n,t)=>n&&(null==e.g||-1===e.g.indexOf(t)),!0));return e},n.prop=function(e,n,t){let r=e;try{let r,l=n.split(".");for(let n=0;n<l.length;n++)r=l[n],n<l.length-1&&(e=e[r]=e[r]||{});return void 0!==t&&(e[r]=t),e[r]}catch(l){throw new Error("Cannot "+(void 0===t?"get":"set")+" path "+n+" on object: "+_(r)+(void 0===t?"":" to value: "+_(t,22)))}},n.modlist=function(e,n){if(n&&e&&0<e.length){if(n.delete&&0<n.delete.length)for(let r=0;r<n.delete.length;r++){let t=n.delete[r];(t<0?-1*t<=e.length:t<e.length)&&(e[(e.length+t)%e.length]=null)}if(n.move)for(let r=0;r<n.move.length;r+=2){let t=(e.length+n.move[r])%e.length,l=(e.length+n.move[r+1])%e.length,i=e[t];e.splice(t,1),e.splice(l,0,i)}let t=e.filter(e=>null!=e);t.length!==e.length&&(e.length=0,e.push(...t))}return e},n.parserwrap=function(e){return{start:function(n,t,i,o){try{return e.start(n,t,i,o)}catch(s){if("SyntaxError"===s.name){let o=0,a=0,u=0,c=r.EMPTY,p=s.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(p){c=p[1],o=parseInt(p[2]),a=n.substring(0,o).replace(/[^\n]/g,r.EMPTY).length;let e=o-1;for(;-1<e&&"\n"!==n.charAt(e);)e--;u=Math.max(n.substring(e,o).length,0)}let f=s.token||(0,l.makeToken)("#UK",m("#UK",t.internal().config),void 0,c,(0,l.makePoint)(c.length,o,s.lineNumber||a,s.columnNumber||u));throw new d(s.code||"json",s.details||{msg:s.message},f,{},s.ctx||{uI:-1,opts:t.options,cfg:t.internal().config,token:f,meta:i,src:()=>n,root:()=>{},plgn:()=>t.internal().plugins,rule:{name:"no-rule"},sub:{},xs:-1,v2:f,v1:f,t0:f,t1:f,tC:-1,kI:-1,rs:[],rsI:0,rsm:{},n:{},log:i?i.log:void 0,F:y(t.internal().config),use:{},NORULE:{name:"no-rule"},NOTOKEN:{name:"no-token"}})}throw s}}}};const T={o:p.open.toUpperCase(),c:p.close.toUpperCase()};n.log_rule=function(e,n,t){e.log(n,e,t,p.logindent+p.rule+p.space,I(e,n,t),p.indent.repeat(n.d)+(n.name+"~"+n.i+p.colon+T[n.state]).padEnd(16),("prev="+n.prev.i+" parent="+n.parent.i+" child="+n.child.i).padEnd(28),N(e,n))},n.log_node=function(e,n,t,r){e.log(n,e,t,r,p.logindent+p.node+p.space,I(e,n,t),p.indent.repeat(n.d)+("why="+r.why+p.space+"<"+e.F(n.node)+">").padEnd(46),N(e,n))},n.log_parse=function(e,n,t,l,i,o,a,u){let c=l&&u.n?s(u.n):null,d=l&&u.u?s(u.u):null,m=l&&u.k?s(u.k):null;e.log&&e.log(e,n,t,p.logindent+p.parse,I(e,n,t),p.indent.repeat(n.d)+(l?"alt="+o:"no-alt"),l&&a?S(a,e.cfg):"",l&&u.g?"g:"+u.g+" ":"",(l&&u.p?"p:"+u.p+" ":"")+(l&&u.r?"r:"+u.r+" ":"")+(l&&u.b?"b:"+u.b+" ":""),a&&a.c?"c:"+i:r.EMPTY,null==c?"":"n:"+c.map(e=>e[0]+"="+e[1]).join(";"),null==d?"":"u:"+d.map(e=>e[0]+"="+e[1]).join(";"),null==m?"":"k:"+m.map(e=>e[0]+"="+e[1]).join(";"))},n.log_stack=function(e,n,t){e.log(p.logindent+p.stack,I(e,n,t),p.indent.repeat(n.d)+"/"+e.rs.slice(0,n.d).map(e=>e.name+"~"+e.i).join("/"),"~","/"+e.rs.slice(0,n.d).map(n=>e.F(n.node)).join("/"),e,n,t)},n.log_lex=function(e,n,t,r,l,i,o,s,a,u){e.log(p.logindent+p.lex+p.space+p.space,I(e,n,t),p.indent.repeat(n.d)+m(o.tin,e.cfg),e.F(o.src),r.sI,r.rI+":"+r.cI,(null==i?void 0:i.name)||"",s?"on:alt="+a+";"+s.g+";t="+u+";"+S(s,e.cfg):"",e.F(t.src.substring(l,l+16)),e,n,t)}})),t=e((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeTextMatcher=t.makeNumberMatcher=t.makeCommentMatcher=t.makeStringMatcher=t.makeLineMatcher=t.makeSpaceMatcher=t.makeFixedMatcher=t.makeMatchMatcher=t.makeToken=t.makePoint=t.makeLex=t.makeNoToken=void 0;const l=n({});class i{constructor(e,n,t,r){this.len=-1,this.sI=0,this.rI=1,this.cI=1,this.token=[],this.len=e,null!=n&&(this.sI=n),null!=t&&(this.rI=t),null!=r&&(this.cI=r)}toString(){return"Point["+[this.sI+"/"+this.len,this.rI,this.cI]+(0<this.token.length?" "+this.token:"")+"]"}[r.INSPECT](){return this.toString()}}const o=(...e)=>new i(...e);t.makePoint=o;class s{constructor(e,n,t,l,i,o,s){this.isToken=!0,this.name=r.EMPTY,this.tin=-1,this.val=void 0,this.src=r.EMPTY,this.sI=-1,this.rI=-1,this.cI=-1,this.len=-1,this.name=e,this.tin=n,this.src=l,this.val=t,this.sI=i.sI,this.rI=i.rI,this.cI=i.cI,this.use=o,this.why=s,this.len=null==l?0:l.length}resolveVal(e,n){return"function"==typeof this.val?this.val(e,n):this.val}bad(e,n){return this.err=e,null!=n&&(this.use=(0,l.deep)(this.use||{},n)),this}toString(){return"Token["+this.name+"="+this.tin+" "+(0,l.snip)(this.src)+(void 0===this.val||"#ST"===this.name||"#TX"===this.name?"":"="+(0,l.snip)(this.val))+" "+[this.sI,this.rI,this.cI]+(null==this.use?"":" "+(0,l.snip)(""+JSON.stringify(this.use).replace(/"/g,""),22))+(null==this.err?"":" "+this.err)+(null==this.why?"":" "+(0,l.snip)(""+this.why,22))+"]"}[r.INSPECT](){return this.toString()}}const a=(...e)=>new s(...e);function u(e,n,t){let r=e.pnt,l=n;if(e.cfg.fixed.lex&&null!=t&&0<t.length){let i,o=e.cfg.fixed.token[t];null!=o&&(i=e.token(o,void 0,t,r)),null!=i&&(r.sI+=i.src.length,r.cI+=i.src.length,null==n?l=i:r.token.push(i))}return l}t.makeToken=a,t.makeNoToken=()=>a("",-1,void 0,r.EMPTY,o(-1)),t.makeFixedMatcher=(e,n)=>{let t=(0,l.regexp)(null,"^(",e.rePart.fixed,")");return function(n){let r=e.fixed;if(!r.lex)return;let l=n.pnt,i=n.src.substring(l.sI).match(t);if(i){let e=i[1],t=e.length;if(0<t){let i,o=r.token[e];return null!=o&&(i=n.token(o,void 0,e,l),l.sI+=t,l.cI+=t),i}}}},t.makeMatchMatcher=(e,n)=>{let t=(0,l.values)(e.match.value),r=(0,l.values)(e.match.token);return 0===t.length&&0===r.length?null:function(n,l,i=0){if(!e.match.lex)return;let o=n.pnt,s=n.src.substring(o.sI),a="o"===l.state?0:1;for(let e of t)if(e.match instanceof RegExp){let t=s.match(e.match);if(t){let r=t[0],l=r.length;if(0<l){let i,s=e.val?e.val(t):r;return i=n.token("#VL",s,r,o),o.sI+=l,o.cI+=l,i}}}else{let t=e.match(n,l);if(null!=t)return t}for(let e of r)if(!e.tin$||l.spec.def.tcol[a][i].includes(e.tin$))if(e instanceof RegExp){let t=s.match(e);if(t){let r=t[0],l=r.length;if(0<l){let t,i=e.tin$;return t=n.token(i,r,r,o),o.sI+=l,o.cI+=l,t}}}else{let t=e(n,l);if(null!=t)return t}}},t.makeCommentMatcher=(e,n)=>{let t=n.comment;e.comment={lex:!!t&&!!t.lex,def:((null==t?void 0:t.def)?(0,l.entries)(t.def):[]).reduce((e,[n,t])=>{if(null==t||!1===t)return e;let r={name:n,start:t.start,end:t.end,line:!!t.line,lex:!!t.lex,suffixMatch:void 0,getSuffixMatch:void 0};return e[n]=r,e},{})};let r=e.comment.lex?(0,l.values)(e.comment.def).filter(e=>e.lex&&e.line):[],i=e.comment.lex?(0,l.values)(e.comment.def).filter(e=>e.lex&&!e.line):[];return function(n,t){if(!e.comment.lex)return;let o=n.pnt,s=n.src.substring(o.sI),a=o.rI,u=o.cI;for(let l of r)if(s.startsWith(l.start)){let t=s.length,r=l.start.length;for(u+=l.start.length;r<t&&!e.line.chars[s[r]];)u++,r++;let i=s.substring(0,r),a=n.token("#CM",void 0,i,o);return o.sI+=i.length,o.cI=u,a}for(let r of i)if(s.startsWith(r.start)){let t=s.length,i=r.start.length,c=r.end;for(u+=r.start.length;i<t&&!s.substring(i).startsWith(c);)e.line.rowChars[s[i]]&&(a++,u=0),u++,i++;if(s.substring(i).startsWith(c)){u+=c.length;let e=s.substring(0,i+c.length),t=n.token("#CM",void 0,e,o);return o.sI+=e.length,o.rI=a,o.cI=u,t}return n.bad(l.S.unterminated_comment,o.sI,o.sI+9*r.start.length)}}},t.makeTextMatcher=(e,n)=>{let t=(0,l.regexp)(e.line.lex?null:"s","^(.*?)",...e.rePart.ender);return function(r){let l=e.text,i=r.pnt,o=r.src.substring(i.sI),s=e.value.def,a=e.value.defre,c=o.match(t);if(c){let t,p=c[1],d=c[2];if(null!=p){let n=p.length;if(0<n){let u;if(e.value.lex)if(void 0!==(u=s[p]))t=r.token("#VL",u.val,p,i),i.sI+=n,i.cI+=n;else for(let e in a){let n=a[e];if(n.match){let e=n.match.exec(n.consume?o:p);if(e&&(n.consume||e[0].length===p.length)){let l=e[0];if(null==n.val)t=r.token("#VL",l,l,i);else{let o=n.val(e);t=r.token("#VL",o,l,i)}i.sI+=l.length,i.cI+=l.length}}}null==t&&l.lex&&(t=r.token("#TX",p,p,i),i.sI+=n,i.cI+=n)}}if(t&&(t=u(r,t,d)),t&&0<e.text.modify.length){const l=e.text.modify;for(let i=0;i<l.length;i++)t.val=l[i](t.val,r,e,n)}return t}}},t.makeNumberMatcher=(e,n)=>{let t=e.number,r=(0,l.regexp)(null,["^([-+]?(0(",[t.hex?"x[0-9a-fA-F_]+":null,t.oct?"o[0-7_]+":null,t.bin?"b[01_]+":null].filter(e=>null!=e).join("|"),")|[.0-9]+([0-9_]*[0-9])?)","(\\.[0-9]?([0-9_]*[0-9])?)?","([eE][-+]?[0-9]+([0-9_]*[0-9])?)?"].join("").replace(/_/g,t.sep?(0,l.escre)(t.sepChar):""),")",...e.rePart.ender),i=t.sep?(0,l.regexp)("g",(0,l.escre)(t.sepChar)):void 0;return function(n){if(t=e.number,!t.lex)return;let l=n.pnt,o=n.src.substring(l.sI),s=e.value.def,a=o.match(r);if(a){let t,r=a[1],o=a[9],c=!0;if(null!=r&&(c=!e.number.exclude||!r.match(e.number.exclude))){let o=r.length;if(0<o){let a;if(e.value.lex&&void 0!==(a=s[r]))t=n.token("#VL",a.val,r,l);else{let e=i?r.replace(i,""):r,s=+e;if(isNaN(s)){let n=e[0];"-"!==n&&"+"!==n||(s=("-"===n?-1:1)*+e.substring(1))}isNaN(s)||(t=n.token("#NR",s,r,l),l.sI+=o,l.cI+=o)}}}return c&&(t=u(n,t,o)),t}}},t.makeStringMatcher=(e,n)=>{let t=n.string||{};return e.string=e.string||{},e.string=(0,l.deep)(e.string,{lex:!!(null==t?void 0:t.lex),quoteMap:(0,l.charset)(t.chars),multiChars:(0,l.charset)(t.multiChars),escMap:(0,l.clean)({...t.escape}),escChar:t.escapeChar,escCharCode:null==t.escapeChar?void 0:t.escapeChar.charCodeAt(0),allowUnknown:!!t.allowUnknown,replaceCodeMap:(0,l.omap)((0,l.clean)({...t.replace}),([e,n])=>[e.charCodeAt(0),n]),hasReplace:!1}),e.string.hasReplace=0<(0,l.keys)(e.string.replaceCodeMap).length,function(n){let t=e.string;if(!t.lex)return;let{quoteMap:i,escMap:o,escChar:s,escCharCode:a,multiChars:u,allowUnknown:c,replaceCodeMap:p,hasReplace:d}=t,{pnt:m,src:f}=n,{sI:h,rI:g,cI:x}=m,v=f.length;if(i[f[h]]){const t=f[h],i=h,k=g,b=u[t];++h,++x;let y,_=[];for(;h<v;h++){x++;let r=f[h];if(y=void 0,t===r){h++;break}if(s===r){h++,x++;let e=o[f[h]];if(null!=e)_.push(e);else if("x"===f[h]){h++;let e=parseInt(f.substring(h,h+2),16);if(isNaN(e))return h-=2,x-=2,m.sI=h,m.cI=x,n.bad(l.S.invalid_ascii,h,h+4);let t=String.fromCharCode(e);_.push(t),h+=1,x+=2}else if("u"===f[h]){h++;let e="{"===f[h]?(h++,1):0,t=e?6:4,r=parseInt(f.substring(h,h+t),16);if(isNaN(r))return h=h-2-e,x-=2,m.sI=h,m.cI=x,n.bad(l.S.invalid_unicode,h,h+t+2+2*e);let i=String.fromCodePoint(r);_.push(i),h+=t-1+e,x+=t+e}else{if(!c)return m.sI=h,m.cI=x-1,n.bad(l.S.unexpected,h,h+1);_.push(f[h])}}else if(d&&void 0!==(y=p[f.charCodeAt(h)]))_.push(y),x++;else{let r=h,i=t.charCodeAt(0),o=f.charCodeAt(h);for(;(!d||void 0===(y=p[o]))&&h<v&&32<=o&&i!==o&&a!==o;)o=f.charCodeAt(++h),x++;if(x--,void 0===y&&o<32){if(!b||!e.line.chars[f[h]])return m.sI=h,m.cI=x,n.bad(l.S.unprintable,h,h+1);e.line.rowChars[f[h]]&&(m.rI=++g),x=1,_.push(f.substring(r,h+1))}else _.push(f.substring(r,h)),h--}}if(f[h-1]!==t||m.sI===h-1)return m.rI=k,n.bad(l.S.unterminated_string,i,h);const E=n.token("#ST",_.join(r.EMPTY),f.substring(m.sI,h),m);return m.sI=h,m.rI=g,m.cI=x,E}}},t.makeLineMatcher=(e,n)=>function(n){if(!e.line.lex)return;let t,{chars:r,rowChars:l}=e.line,{pnt:i,src:o}=n,{sI:s,rI:a}=i,u=e.line.single;for(u&&(t={});r[o[s]]&&!(t&&(t[o[s]]=(t[o[s]]||0)+1,u&&1<t[o[s]]));)a+=l[o[s]]?1:0,s++;if(i.sI<s){let e=o.substring(i.sI,s);const t=n.token("#LN",void 0,e,i);return i.sI+=e.length,i.rI=a,i.cI=1,t}},t.makeSpaceMatcher=(e,n)=>function(n){if(!e.space.lex)return;let{chars:t}=e.space,{pnt:r,src:l}=n,{sI:i,cI:o}=r;for(;t[l[i]];)i++,o++;if(r.sI<i){let e=l.substring(r.sI,i);const t=n.token("#SP",void 0,e,r);return r.sI+=e.length,r.cI=o,t}};class c{constructor(e){this.src=r.EMPTY,this.ctx={},this.cfg={},this.pnt=o(-1),this.ctx=e,this.src=e.src(),this.cfg=e.cfg,this.pnt=o(this.src.length)}token(e,n,t,r,i,o){let s,u;return"string"==typeof e?(u=e,s=(0,l.tokenize)(u,this.cfg)):(s=e,u=(0,l.tokenize)(e,this.cfg)),a(u,s,n,t,r||this.pnt,i,o)}next(e,n,t,r){let i,o,s=this.pnt,a=s.sI;if(s.end)i=s.end;else if(0<s.token.length)i=s.token.shift();else if(s.len<=s.sI)s.end=this.token("#ZZ",void 0,"",s),i=s.end;else{try{for(let n of this.cfg.lex.match)if(i=n(this,e,r)){o=n;break}}catch(u){i=i||this.token("#BD",void 0,this.src[s.sI],s,{err:u},u.code||l.S.unexpected)}i=i||this.token("#BD",void 0,this.src[s.sI],s,void 0,l.S.unexpected)}return this.ctx.log&&(0,l.log_lex)(this.ctx,e,this,s,a,o,i,n,t,r),this.ctx.sub.lex&&this.ctx.sub.lex.map(n=>n(i,e,this.ctx)),i}tokenize(e){return(0,l.tokenize)(e,this.cfg)}bad(e,n,t){return this.token("#BD",void 0,0<=n&&n<=t?this.src.substring(n,t):this.src[this.pnt.sI],void 0,void 0,e)}}t.makeLex=(...e)=>new c(...e)})),r={};Object.defineProperty(r,"__esModule",{value:!0}),r.STRING=r.INSPECT=r.EMPTY=r.AFTER=r.BEFORE=r.CLOSE=r.OPEN=void 0,r.OPEN="o",r.CLOSE="c",r.BEFORE="b",r.AFTER="a",r.EMPTY="",r.INSPECT=Symbol.for("nodejs.util.inspect.custom"),r.STRING="string";var l={};Object.defineProperty(l,"__esModule",{value:!0}),l.defaults=void 0;const i=t({}),o={tag:"-",fixed:{lex:!0,token:{"#OB":"{","#CB":"}","#OS":"[","#CS":"]","#CL":":","#CA":","}},match:{lex:!0,token:{}},tokenSet:{IGNORE:["#SP","#LN","#CM"],VAL:["#TX","#NR","#ST","#VL"],KEY:["#TX","#NR","#ST","#VL"]},space:{lex:!0,chars:" \t"},line:{lex:!0,chars:"\r\n",rowChars:"\n",single:!1},text:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,sep:"_",exclude:void 0},comment:{lex:!0,def:{hash:{line:!0,start:"#",lex:!0},slash:{line:!0,start:"//",lex:!0},multi:{line:!1,start:"/*",end:"*/",lex:!0}}},string:{lex:!0,chars:"'\"`",multiChars:"`",escapeChar:"\\",escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",'"':'"',"'":"'","`":"`","\\":"\\","/":"/"},allowUnknown:!0},map:{extend:!0,merge:void 0},list:{property:!0},value:{lex:!0,def:{true:{val:!0},false:{val:!1},null:{val:null}}},ender:[],plugin:{},debug:{get_console:()=>console,maxlen:99,print:{config:!1,src:void 0}},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated_string:"unterminated string: $src",unterminated_comment:"unterminated comment: $src",unknown_rule:"unknown rule: $rulename"},hint:function(e=((e,n="replace")=>e[n](/[A-Z]/g,e=>" "+e.toLowerCase())[n](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),n="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!\n\n~code: $code,~details: \n$details|~theCharacter(s) $srcWereNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~thisStringHasNoEndQuote.|~thisCommentIsNeverClosed.|~noRuleNamed $rulenameIsDefined.~thisIsProbablyAnErrorInThe\ngrammarOfAPlugin.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated_string|unterminated_comment|unknown_rule".split("|").reduce((t,r,l)=>(t[r]=e(n[l]),t),{})},lex:{match:{match:{order:1e6,make:i.makeMatchMatcher},fixed:{order:2e6,make:i.makeFixedMatcher},space:{order:3e6,make:i.makeSpaceMatcher},line:{order:4e6,make:i.makeLineMatcher},string:{order:5e6,make:i.makeStringMatcher},comment:{order:6e6,make:i.makeCommentMatcher},number:{order:7e6,make:i.makeNumberMatcher},text:{order:8e6,make:i.makeTextMatcher}},empty:!0,emptyResult:void 0},rule:{start:"val",finish:!0,maxmul:3,include:"",exclude:""},result:{fail:[]},config:{modify:{}},parser:{start:void 0}};l.defaults=o;var s={};Object.defineProperty(s,"__esModule",{value:!0}),s.makeRuleSpec=s.makeNoRule=s.makeRule=void 0;const a=n({});class u{constructor(e,n,t){this.i=-1,this.name=r.EMPTY,this.node=null,this.state=r.OPEN,this.n=Object.create(null),this.d=-1,this.use=Object.create(null),this.keep=Object.create(null),this.bo=!1,this.ao=!1,this.bc=!1,this.ac=!1,this.os=0,this.cs=0,this.need=0,this.i=n.uI++,this.name=e.name,this.spec=e,this.child=n.NORULE,this.parent=n.NORULE,this.prev=n.NORULE,this.o0=n.NOTOKEN,this.o1=n.NOTOKEN,this.c0=n.NOTOKEN,this.c1=n.NOTOKEN,this.node=t,this.d=n.rsI,this.bo=null!=e.def.bo,this.ao=null!=e.def.ao,this.bc=null!=e.def.bc,this.ac=null!=e.def.ac}process(e,n){return this.spec.process(this,e,n,this.state)}toString(){return"[Rule "+this.name+"~"+this.i+"]"}}const c=(...e)=>new u(...e);s.makeRule=c,s.makeNoRule=e=>c(g(e.cfg,{}),e);class p{constructor(){this.p=r.EMPTY,this.r=r.EMPTY,this.b=0}}const d=(...e)=>new p(...e),m=d(),f=d();class h{constructor(e,n){this.name=r.EMPTY,this.def={open:[],close:[],bo:[],bc:[],ao:[],ac:[],tcol:[]},this.cfg=e,this.def=Object.assign(this.def,n),this.def.open=(this.def.open||[]).filter(e=>null!=e),this.def.close=(this.def.close||[]).filter(e=>null!=e);for(let t of[...this.def.open,...this.def.close])x(t)}tin(e){return(0,a.tokenize)(e,this.cfg)}add(e,n,t){let r=(null==t?void 0:t.append)?"push":"unshift",l=((0,a.isarr)(n)?n:[n]).filter(e=>null!=e&&"object"==typeof e).map(e=>x(e)),i="o"===e?"open":"close",o=this.def[i];return o[r](...l),(0,a.modlist)(o,t),(0,a.filterRules)(this,this.cfg),this.norm(),this}open(e,n){return this.add("o",e,n)}close(e,n){return this.add("c",e,n)}action(e,n,t,r){let l=this.def[n+t];return e?l.push(r):l.unshift(r),this}bo(e,n){return this.action(!n||!!e,r.BEFORE,r.OPEN,n||e)}ao(e,n){return this.action(!n||!!e,r.AFTER,r.OPEN,n||e)}bc(e,n){return this.action(!n||!!e,r.BEFORE,r.CLOSE,n||e)}ac(e,n){return this.action(!n||!!e,r.AFTER,r.CLOSE,n||e)}clear(){return this.def.open.length=0,this.def.close.length=0,this.def.bo.length=0,this.def.ao.length=0,this.def.bc.length=0,this.def.ac.length=0,this}norm(){this.def.open.map(e=>x(e)),this.def.close.map(e=>x(e));const e=[];function n(e,n,t){return t[e]=t[e]||[],[function(e,t){if(t.s&&t.s[n]){let r=[...new Set(e.concat(t.s[n]))];e.length=0,e.push(...r)}return e},t[e][n]=t[e][n]||[]]}return this.def.open.reduce(...n(0,0,e)),this.def.open.reduce(...n(0,1,e)),this.def.close.reduce(...n(1,0,e)),this.def.close.reduce(...n(1,1,e)),this.def.tcol=e,this}process(e,n,t,l){n.log&&(0,a.log_rule)(n,e,t);let i="o"===l,o=i?e:n.NORULE,s=i?"O":"C",u=this.def,p=i?u.open:u.close,d=i?e.bo?u.bo:null:e.bc?u.bc:null;if(d){let t;for(let r=0;r<d.length;r++)if(t=d[r].call(this,e,n,o,t),(null==t?void 0:t.isToken)&&(null==t?void 0:t.err))return this.bad(t,e,n,{is_open:i})}let h=0<p.length?function(e,n,t,l,i){let o=m;o.b=0,o.p=r.EMPTY,o.r=r.EMPTY,o.n=void 0,o.h=void 0,o.a=void 0,o.u=void 0,o.k=void 0,o.e=void 0;let s=null,u=0,c=!0,p=1<<i.cfg.t.AA-1,d=i.cfg.tokenSetTins.IGNORE;function f(e,n,r,l){let o;do{o=t.next(e,n,r,l),i.tC++}while(d[o.tin]);return o}let h=n.length;for(u=0;u<h;u++){s=n[u];let t=!1,r=!1;if(c=!0,s.S0){let e=(i.t0=i.NOTOKEN!==i.t0?i.t0:i.t0=f(l,s,u,0)).tin;if(t=!0,c=!!(s.S0[e/31|0]&(1<<e%31-1|p)),c&&(r=null!=s.S1,s.S1)){let e=(i.t1=i.NOTOKEN!==i.t1?i.t1:i.t1=f(l,s,u,1)).tin;r=!0,c=!!(s.S1[e/31|0]&(1<<e%31-1|p))}}if(e?(l.o0=t?i.t0:i.NOTOKEN,l.o1=r?i.t1:i.NOTOKEN,l.os=(t?1:0)+(r?1:0)):(l.c0=t?i.t0:i.NOTOKEN,l.c1=r?i.t1:i.NOTOKEN,l.cs=(t?1:0)+(r?1:0)),c&&s.c&&(c=c&&s.c(l,i,o)),c)break;s=null}c||(o.e=i.t0),s&&(o.n=null!=s.n?s.n:o.n,o.h=null!=s.h?s.h:o.h,o.a=null!=s.a?s.a:o.a,o.u=null!=s.u?s.u:o.u,o.k=null!=s.k?s.k:o.k,o.g=null!=s.g?s.g:o.g,o.e=s.e&&s.e(l,i,o)||void 0,o.p=null!=s.p&&!1!==s.p?"string"==typeof s.p?s.p:s.p(l,i,o):o.p,o.r=null!=s.r&&!1!==s.r?"string"==typeof s.r?s.r:s.r(l,i,o):o.r,o.b=null!=s.b&&!1!==s.b?"number"==typeof s.b?s.b:s.b(l,i,o):o.b);let g=u<n.length;return i.log&&(0,a.log_parse)(i,l,t,g,c,u,s,o),o}(i,p,t,e,n):f;if(h.h&&(h=h.h(e,n,h,o)||h,s+="H"),h.e)return this.bad(h.e,e,n,{is_open:i});if(h.n)for(let r in h.n)e.n[r]=0===h.n[r]?0:(null==e.n[r]?0:e.n[r])+h.n[r];if(h.u&&(e.use=Object.assign(e.use,h.u)),h.k&&(e.keep=Object.assign(e.keep,h.k)),h.a){s+="A";let t=h.a(e,n,h);if(t&&t.isToken&&t.err)return this.bad(t,e,n,{is_open:i})}if(h.p){n.rs[n.rsI++]=e;let t=n.rsm[h.p];if(!t)return this.bad(this.unknownRule(n.t0,h.p),e,n,{is_open:i});o=e.child=c(t,n,e.node),o.parent=e,o.n={...e.n},0<Object.keys(e.keep).length&&(o.keep={...e.keep}),s+="P`"+h.p+"`"}else if(h.r){let t=n.rsm[h.r];if(!t)return this.bad(this.unknownRule(n.t0,h.r),e,n,{is_open:i});o=c(t,n,e.node),o.parent=e.parent,o.prev=e,o.n={...e.n},0<Object.keys(e.keep).length&&(o.keep={...e.keep}),s+="R`"+h.r+"`"}else i||(o=n.rs[--n.rsI]||n.NORULE);let g=i?e.ao?u.ao:null:e.ac?u.ac:null;if(g){let t;for(let r=0;r<g.length;r++)if(t=g[r](e,n,o,t),(null==t?void 0:t.isToken)&&(null==t?void 0:t.err))return this.bad(t,e,n,{is_open:i})}o.why=s,n.log&&(0,a.log_node)(n,e,t,o),r.OPEN===e.state&&(e.state=r.CLOSE);let x=e[i?"os":"cs"]-(h.b||0);return 1===x?(n.v2=n.v1,n.v1=n.t0,n.t0=n.t1,n.t1=n.NOTOKEN):2==x&&(n.v2=n.t1,n.v1=n.t0,n.t0=n.NOTOKEN,n.t1=n.NOTOKEN),o}bad(e,n,t,r){throw new a.JsonicError(e.err||a.S.unexpected,{...e.use,state:r.is_open?a.S.open:a.S.close},e,n,t)}unknownRule(e,n){return e.err="unknown_rule",e.use=e.use||{},e.use.rulename=n,e}}const g=(...e)=>new h(...e);function x(e){if(null!=e.c){let n=e.c.n,t=e.c.d;null==n&&null==t||(e.c=function(e){let r=!0;if(null!=n)for(let t in n)r=r&&(null==e.n[t]||e.n[t]<=(null==n[t]?0:n[t]));return null!=t&&(r=r&&e.d<=t),r},null!=n&&(e.c.n=n),null!=t&&(e.c.d=t))}if(r.STRING===typeof e.g&&(e.g=e.g.split(/\s*,\s*/)),e.s&&0!==e.s.length){const n=e=>e.flat().filter(e=>"number"==typeof e),t=(e,n)=>e.filter(e=>31*n<=e&&e<31*(n+1)),r=(e,n)=>e.reduce((e,t)=>1<<t-(31*n+1)|e,0),l=n([e.s[0]]),i=n([e.s[1]]),o=e;o.S0=0<l.length?new Array(Math.max(...l.map(e=>1+e/31|0))).fill(null).map((e,n)=>n).map(e=>r(t(l,e),e)):null,o.S1=0<i.length?new Array(Math.max(...i.map(e=>1+e/31|0))).fill(null).map((e,n)=>n).map(e=>r(t(i,e),e)):null}else e.s=null;return e.p||(e.p=null),e.r||(e.r=null),e.b||(e.b=null),e}s.makeRuleSpec=g;var v={};Object.defineProperty(v,"__esModule",{value:!0}),v.makeParser=v.makeRuleSpec=v.makeRule=void 0;const k=n({}),b=t({});Object.defineProperty(v,"makeRule",{enumerable:!0,get:function(){return s.makeRule}}),Object.defineProperty(v,"makeRuleSpec",{enumerable:!0,get:function(){return s.makeRuleSpec}});class y{constructor(e,n){this.rsm={},this.options=e,this.cfg=n}rule(e,n){if(null==e)return this.rsm;let t=this.rsm[e];if(null===n)delete this.rsm[e];else if(void 0!==n)return t=this.rsm[e]=this.rsm[e]||(0,s.makeRuleSpec)(this.cfg,{}),t=this.rsm[e]=n(this.rsm[e],this)||this.rsm[e],void(t.name=e);return t}start(e,n,t,l){let i,o=(0,b.makeToken)("#ZZ",(0,k.tokenize)("#ZZ",this.cfg),void 0,r.EMPTY,(0,b.makePoint)(-1)),a=(0,b.makeNoToken)(),u={uI:0,opts:this.options,cfg:this.cfg,meta:t||{},src:()=>e,root:()=>i,plgn:()=>n.internal().plugins,rule:{},sub:n.internal().sub,xs:-1,v2:o,v1:o,t0:a,t1:a,tC:-2,kI:-1,rs:[],rsI:0,rsm:this.rsm,log:void 0,F:(0,k.srcfmt)(this.cfg),use:{},NOTOKEN:a,NORULE:{}};u=(0,k.deep)(u,l);let c=(0,s.makeNoRule)(u);if(u.NORULE=c,u.rule=c,(0,k.makelog)(u,t),""===e){if(this.cfg.lex.empty)return this.cfg.lex.emptyResult;throw new k.JsonicError(k.S.unexpected,{src:e},u.t0,c,u)}let p=(0,k.badlex)((0,b.makeLex)(u),(0,k.tokenize)("#BD",this.cfg),u),d=this.rsm[this.cfg.rule.start];if(null==d)return;let m=(0,s.makeRule)(d,u);i=m;let f=2*(0,k.keys)(this.rsm).length*p.src.length*2*u.cfg.rule.maxmul,h=0;for(;c!==m&&h<f;)u.kI=h,u.rule=m,u.log&&u.log(u.kI+":"),u.sub.rule&&u.sub.rule.map(e=>e(m,u)),m=m.process(u,p),u.log&&(0,k.log_stack)(u,m,p),h++;if(o.tin!==p.next(m).tin)throw new k.JsonicError(k.S.unexpected,{},u.t0,c,u);const g=u.root().node;if(this.cfg.result.fail.includes(g))throw new k.JsonicError(k.S.unexpected,{},u.t0,c,u);return g}clone(e,n){let t=new y(e,n);return t.rsm=Object.keys(this.rsm).reduce((e,n)=>(e[n]=(0,k.filterRules)(this.rsm[n],this.cfg),e),{}),t.norm(),t}norm(){(0,k.values)(this.rsm).map(e=>e.norm())}}v.makeParser=(...e)=>new y(...e);var _={};function E(e){const{deep:n}=e.util,{OB:t,CB:r,OS:l,CS:i,CL:o,CA:s,TX:a,ST:u,ZZ:c}=e.token,{VAL:p,KEY:d}=e.tokenSet,m=(e,n)=>{if(!n.cfg.rule.finish)return n.t0.src="END_OF_SOURCE",n.t0},f=e=>{const n=e.o0,t=u===n.tin||a===n.tin?n.val:n.src;e.use.key=t};e.rule("val",e=>{e.bo(e=>e.node=void 0).open([{s:[t],p:"map",b:1,g:"map,json"},{s:[l],p:"list",b:1,g:"list,json"},{s:[p],g:"val,json"}]).close([{s:[c],g:"end,json"},{b:1,g:"more,json"}]).bc((e,n)=>{e.node=void 0===e.node?void 0===e.child.node?0===e.os?void 0:e.o0.resolveVal(e,n):e.child.node:e.node})}),e.rule("map",e=>{e.bo(e=>{e.node={}}).open([{s:[t,r],b:1,n:{pk:0},g:"map,json"},{s:[t],p:"pair",n:{pk:0},g:"map,json,pair"}]).close([{s:[r],g:"end,json"}])}),e.rule("list",e=>{e.bo(e=>{e.node=[]}).open([{s:[l,i],b:1,g:"list,json"},{s:[l],p:"elem",g:"list,elem,json"}]).close([{s:[i],g:"end,json"}])}),e.rule("pair",e=>{e.open([{s:[d,o],p:"val",u:{pair:!0},a:f,g:"map,pair,key,json"}]).bc((e,n)=>{e.use.pair&&(e.use.prev=e.node[e.use.key],e.node[e.use.key]=e.child.node)}).close([{s:[s],r:"pair",g:"map,pair,json"},{s:[r],b:1,g:"map,pair,json"}])}),e.rule("elem",e=>{e.open([{p:"val",g:"list,elem,val,json"}]).bc(e=>{!0!==e.use.done&&e.node.push(e.child.node)}).close([{s:[s],r:"elem",g:"list,elem,json"},{s:[i],b:1,g:"list,elem,json"}])});const h=(e,t)=>{let r=e.use.key,l=e.child.node;const i=e.use.prev;l=void 0===l?null:l,e.node[r]=null==i?l:t.cfg.map.merge?t.cfg.map.merge(i,l,e,t):t.cfg.map.extend?n(i,l):l};e.rule("val",e=>{e.open([{s:[d,o],p:"map",b:2,n:{pk:1},g:"pair,jsonic"},{s:[p],g:"val,json"},{s:[[r,i]],b:1,c:e=>0<e.d,g:"val,imp,null,jsonic"},{s:[s],c:e=>0===e.d,p:"list",b:1,g:"list,imp,jsonic"},{s:[s],b:1,g:"list,val,imp,null,jsonic"},{s:[c],g:"jsonic"}],{append:!0,delete:[2]}).close([{s:[[r,i]],b:1,g:"val,json,close",e:(e,n)=>0===e.d?n.t0:void 0},{s:[s],c:{n:{dlist:0,dmap:0}},r:"list",u:{implist:!0},g:"list,val,imp,comma,jsonic"},{c:{n:{dlist:0,dmap:0}},r:"list",u:{implist:!0},g:"list,val,imp,space,jsonic",b:1},{s:[c],g:"jsonic"}],{append:!0,move:[1,-1]})}),e.rule("map",e=>{e.bo(e=>{e.n.dmap=1+(e.n.dmap?e.n.dmap:0)}).open([{s:[t,c],b:1,e:m,g:"end,jsonic"}]).open([{s:[d,o],p:"pair",b:2,g:"pair,list,val,imp"}],{append:!0}).close([{s:[r],c:{n:{pk:0}},g:"end,json"},{s:[r],b:1,g:"path,jsonic"},{s:[[s,i,...p]],b:1,g:"end,path,jsonic"},{s:[c],e:m,g:"end,jsonic"}],{append:!0,delete:[0]})}),e.rule("list",e=>{e.bo(e=>{e.n.dlist=1+(e.n.dlist?e.n.dlist:0),e.prev.use.implist&&(e.node.push(e.prev.node),e.prev.node=e.node)}).open({c:e=>e.prev.use.implist,p:"elem"}).open([{s:[s],p:"elem",b:1,g:"list,elem,val,imp"},{p:"elem",g:"list,elem"}],{append:!0}).close([{s:[c],e:m,g:"end,jsonic"}],{append:!0})}),e.rule("pair",(e,n)=>{e.open([{s:[s],g:"map,pair,comma"}],{append:!0}).bc((e,n)=>{e.use.pair&&h(e,n)}).close([{s:[r],c:{n:{pk:0}},b:1,g:"map,pair,json"},{s:[s,r],c:{n:{pk:0}},b:1,g:"map,pair,comma,jsonic"},{s:[s,c],g:"end,jsonic"},{s:[s],c:{n:{pk:0}},r:"pair",g:"map,pair,json"},{s:[s],c:{n:{dmap:1}},r:"pair",g:"map,pair,jsonic"},{s:[d],c:{n:{dmap:1}},r:"pair",b:1,g:"map,pair,imp,jsonic"},{s:[[r,s,i,...d]],b:1,g:"map,pair,imp,path,jsonic",c:e=>0<e.n.pk},{s:[i],e:e=>e.c0,g:"end,jsonic"},{s:[c],e:m,g:"map,pair,json"},{r:"pair",b:1,g:"map,pair,imp,jsonic"}],{append:!0,delete:[0,1]})}),e.rule("elem",(e,n)=>{e.open([{s:[s,s],b:2,u:{done:!0},a:e=>e.node.push(null),g:"list,elem,imp,null,jsonic"},{s:[s],u:{done:!0},a:e=>e.node.push(null),g:"list,elem,imp,null,jsonic"},{s:[d,o],e:n.cfg.list.property?void 0:(e,n)=>n.t0,p:"val",n:{pk:1,dmap:1},u:{done:!0,pair:!0},a:f,g:"elem,pair,jsonic"}]).bc((e,n)=>{!0===e.use.pair&&(e.use.prev=e.node[e.use.key],h(e,n))}).close([{s:[s,[i,c]],b:1,g:"list,elem,comma,jsonic"},{s:[s],r:"elem",g:"list,elem,json"},{s:[i],b:1,g:"list,elem,json"},{s:[c],e:m,g:"list,elem,json"},{s:[r],e:e=>e.c0,g:"end,jsonic"},{r:"elem",b:1,g:"list,elem,imp,jsonic"}],{delete:[-1,-2]})})}Object.defineProperty(_,"__esModule",{value:!0}),_.makeJSON=_.grammar=void 0,_.grammar=E,_.makeJSON=function(e){let n=e.make({grammar$:!1,text:{lex:!1},number:{hex:!1,oct:!1,bin:!1,sep:null,exclude:/^00+/},string:{chars:'"',multiChars:"",allowUnknown:!1,escape:{v:null}},comment:{lex:!1},map:{extend:!1},lex:{empty:!1},rule:{finish:!1,include:"json"},result:{fail:[void 0,NaN]},tokenSet:{KEY:["#ST",null,null,null]}});return E(n),n};var j={};Object.defineProperty(j,"__esModule",{value:!0}),j.Debug=void 0;const O=(e,n)=>{const{keys:t,values:r,entries:l}=e.util;e.debug={describe:function(){let n=e.internal().config.lex.match,i=e.rule();return["========= RULES =========",I(e,t(i),i),"\n","========= ALTS =========",r(i).map(n=>"  "+n.name+":\n"+S(e,n,"open")+S(e,n,"close")).join("\n\n"),"\n","========= LEXER =========","  "+(n&&n.map(e=>e.order+": "+e.matcher+" ("+e.make.name+")")||[]).join("\n  "),"\n","\n","========= PLUGIN =========","  "+e.internal().plugins.map(e=>e.name+(e.options?l(e.options).reduce((e,n)=>e+"\n    "+n[0]+": "+JSON.stringify(n[1]),""):"")).join("\n  "),"\n"].join("\n")}};const i=e.use.bind(e);e.use=(...e)=>{let t=i(...e);return n.print&&t.internal().config.debug.get_console().log(t.debug.describe()),t},n.trace};function S(e,n,t){const{entries:r}=e.util;return 0===n.def[t].length?"":"    "+t.toUpperCase()+":\n"+n.def[t].map((n,t)=>{var l,i;return"      "+(""+t).padStart(5," ")+" "+("["+(n.s||[]).map(n=>null==n?"***INVALID***":"number"==typeof n?e.token[n]:"["+n.map(n=>e.token[n])+"]").join(" ")+"] ").padEnd(32," ")+(n.r?" r="+("string"==typeof n.r?n.r:"<F>"):"")+(n.p?" p="+("string"==typeof n.p?n.p:"<F>"):"")+(n.r||n.p?"":"\t")+"\t"+(null==n.b?"":"b="+n.b)+"\t"+(null==n.n?"":"n="+r(n.n).map(([e,n])=>e+":"+n))+"\t"+(null==n.a?"":"A")+(null==n.c?"":"C")+(null==n.h?"":"H")+"\t"+(null==(null===(l=n.c)||void 0===l?void 0:l.n)?"\t":" CN="+r(n.c.n).map(([e,n])=>e+":"+n))+(null==(null===(i=n.c)||void 0===i?void 0:i.d)?"":" CD="+n.c.d)+(n.g?"\tg="+n.g:"")}).join("\n")+"\n"}function I(e,n,t){const{values:r,omap:l}=e.util;return n.reduce((e,n)=>e+"  "+n+":\n    "+r(l({op:N(t,n,"open","p"),or:N(t,n,"open","r"),cp:N(t,n,"close","p"),cr:N(t,n,"close","r")},([e,n])=>[1<n.length?e:void 0,e+": "+n])).join("\n    ")+"\n","")}function N(e,n,t,r){return[...new Set(e[n].def[t].filter(e=>e[r]).map(e=>e[r]).map(e=>"string"==typeof e?e:"<F>"))].join(" ")}j.Debug=O,O.defaults={print:!0,trace:!1};var T={exports:{}};Object.defineProperty(T.exports,"__esModule",{value:!0}),T.exports.EMPTY=T.exports.AFTER=T.exports.BEFORE=T.exports.CLOSE=T.exports.OPEN=T.exports.makeTextMatcher=T.exports.makeNumberMatcher=T.exports.makeCommentMatcher=T.exports.makeStringMatcher=T.exports.makeLineMatcher=T.exports.makeSpaceMatcher=T.exports.makeFixedMatcher=T.exports.makeParser=T.exports.makeLex=T.exports.makeRuleSpec=T.exports.makeRule=T.exports.makePoint=T.exports.makeToken=T.exports.make=T.exports.util=T.exports.Debug=T.exports.JsonicError=T.exports.Jsonic=void 0,Object.defineProperty(T.exports,"OPEN",{enumerable:!0,get:function(){return r.OPEN}}),Object.defineProperty(T.exports,"CLOSE",{enumerable:!0,get:function(){return r.CLOSE}}),Object.defineProperty(T.exports,"BEFORE",{enumerable:!0,get:function(){return r.BEFORE}}),Object.defineProperty(T.exports,"AFTER",{enumerable:!0,get:function(){return r.AFTER}}),Object.defineProperty(T.exports,"EMPTY",{enumerable:!0,get:function(){return r.EMPTY}});const M=n({});Object.defineProperty(T.exports,"JsonicError",{enumerable:!0,get:function(){return M.JsonicError}});const P=t({});Object.defineProperty(T.exports,"makePoint",{enumerable:!0,get:function(){return P.makePoint}}),Object.defineProperty(T.exports,"makeToken",{enumerable:!0,get:function(){return P.makeToken}}),Object.defineProperty(T.exports,"makeLex",{enumerable:!0,get:function(){return P.makeLex}}),Object.defineProperty(T.exports,"makeFixedMatcher",{enumerable:!0,get:function(){return P.makeFixedMatcher}}),Object.defineProperty(T.exports,"makeSpaceMatcher",{enumerable:!0,get:function(){return P.makeSpaceMatcher}}),Object.defineProperty(T.exports,"makeLineMatcher",{enumerable:!0,get:function(){return P.makeLineMatcher}}),Object.defineProperty(T.exports,"makeStringMatcher",{enumerable:!0,get:function(){return P.makeStringMatcher}}),Object.defineProperty(T.exports,"makeCommentMatcher",{enumerable:!0,get:function(){return P.makeCommentMatcher}}),Object.defineProperty(T.exports,"makeNumberMatcher",{enumerable:!0,get:function(){return P.makeNumberMatcher}}),Object.defineProperty(T.exports,"makeTextMatcher",{enumerable:!0,get:function(){return P.makeTextMatcher}}),Object.defineProperty(T.exports,"makeRule",{enumerable:!0,get:function(){return v.makeRule}}),Object.defineProperty(T.exports,"makeRuleSpec",{enumerable:!0,get:function(){return v.makeRuleSpec}}),Object.defineProperty(T.exports,"makeParser",{enumerable:!0,get:function(){return v.makeParser}}),Object.defineProperty(T.exports,"Debug",{enumerable:!0,get:function(){return j.Debug}});const C={tokenize:M.tokenize,srcfmt:M.srcfmt,clone:M.clone,charset:M.charset,trimstk:M.trimstk,makelog:M.makelog,badlex:M.badlex,extract:M.extract,errinject:M.errinject,errdesc:M.errdesc,configure:M.configure,parserwrap:M.parserwrap,mesc:M.mesc,escre:M.escre,regexp:M.regexp,prop:M.prop,str:M.str,clean:M.clean,deep:M.deep,omap:M.omap,keys:M.keys,values:M.values,entries:M.entries};function R(e,n){let t=!0;if("jsonic"===e)t=!1;else if("json"===e)return(0,_.makeJSON)(w);e="string"==typeof e?{}:e;let r={parser:null,config:null,plugins:[],sub:{lex:void 0,rule:void 0},mark:Math.random()},i=(0,M.deep)({},n?{...n.options}:!1===(null==e?void 0:e.defaults$)?{}:l.defaults,e||{}),o=function(e,n,t){var r;if(M.S.string===typeof e){let l=o.internal();return((null===(r=s.parser)||void 0===r?void 0:r.start)?(0,M.parserwrap)(s.parser):l.parser).start(e,o,n,t)}return e},s=e=>{if(null!=e&&M.S.object===typeof e){(0,M.deep)(i,e),(0,M.configure)(o,r.config,i);let n=o.internal().parser;r.parser=n.clone(i,r.config)}return{...o.options}},a={token:e=>(0,M.tokenize)(e,r.config,o),tokenSet:e=>(0,M.findTokenSet)(e,r.config),fixed:e=>r.config.fixed.ref[e],options:(0,M.deep)(s,i),config:()=>(0,M.deep)(r.config),parse:o,use:function(e,n){const t=e.name.toLowerCase(),r=(0,M.deep)({},e.defaults||{},n||{});o.options({plugin:{[t]:r}});let l=o.options.plugin[t];return o.internal().plugins.push(e),e.options=l,e(o,l)||o},rule:(e,n)=>o.internal().parser.rule(e,n)||o,make:e=>R(e,o),empty:e=>R({defaults$:!1,standard$:!1,grammar$:!1,...e||{}}),id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+(null==s.tag?"":"/"+s.tag),toString:()=>a.id,sub:e=>(e.lex&&(r.sub.lex=r.sub.lex||[],r.sub.lex.push(e.lex)),e.rule&&(r.sub.rule=r.sub.rule||[],r.sub.rule.push(e.rule)),o),util:C};if((0,M.defprop)(a.make,M.S.name,{value:M.S.make}),t?(0,M.assign)(o,a):(0,M.assign)(o,{empty:a.empty,parse:a.parse,sub:a.sub,id:a.id,toString:a.toString}),(0,M.defprop)(o,"internal",{value:()=>r}),n){for(let t in n)void 0===o[t]&&(o[t]=n[t]);o.parent=n;let e=n.internal();r.config=(0,M.deep)({},e.config),(0,M.configure)(o,r.config,i),(0,M.assign)(o.token,r.config.t),r.plugins=[...e.plugins],r.parser=e.parser.clone(i,r.config)}else{let e={...o,...a};r.config=(0,M.configure)(e,void 0,i),r.plugins=[],r.parser=(0,v.makeParser)(i,r.config),!1!==i.grammar$&&(0,_.grammar)(e)}return o}let w;T.exports.util=C,T.exports.make=R;let A=w=R("jsonic");return T.exports.Jsonic=A,w.Jsonic=w,w.JsonicError=M.JsonicError,w.Debug=j.Debug,w.makeLex=P.makeLex,w.makeParser=v.makeParser,w.makeToken=P.makeToken,w.makePoint=P.makePoint,w.makeRule=v.makeRule,w.makeRuleSpec=v.makeRuleSpec,w.makeFixedMatcher=P.makeFixedMatcher,w.makeSpaceMatcher=P.makeSpaceMatcher,w.makeLineMatcher=P.makeLineMatcher,w.makeStringMatcher=P.makeStringMatcher,w.makeCommentMatcher=P.makeCommentMatcher,w.makeNumberMatcher=P.makeNumberMatcher,w.makeTextMatcher=P.makeTextMatcher,w.OPEN=r.OPEN,w.CLOSE=r.CLOSE,w.BEFORE=r.BEFORE,w.AFTER=r.AFTER,w.EMPTY=r.EMPTY,w.util=C,w.make=R,T.exports.default=A,T.exports=T.exports.Jsonic,T.exports}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),e=e.exports;var n={};Object.defineProperty(n,"__esModule",{value:!0}),n.testing=n.evaluate=n.Expr=void 0;const{omap:t,entries:r,values:l}=e.util,i={};let o=function(e,n){let o=e.token.bind(e),y=e.fixed.bind(e),_=n.op||{};const E=v(o,y,_,"prefix"),j=v(o,y,_,"suffix"),O=v(o,y,_,"infix"),S=v(o,y,_,"ternary"),I=function(e,n,t){return r(t).reduce((t,[r,l])=>{if(l.paren){let o=n(l.osrc)||e("#E"+l.osrc),s=e(o),a=n(l.csrc)||e("#E"+l.csrc),u=e(a);t[o]={name:r+"-paren",osrc:l.osrc,csrc:l.csrc,otkn:s,otin:o,ctkn:u,ctin:a,preval:{active:null!=l.preval&&(null==l.preval.active||l.preval.active),required:null!=l.preval&&null!=l.preval.required&&l.preval.required},use:{},paren:!0,src:l.osrc,left:Number.MIN_SAFE_INTEGER,right:Number.MAX_SAFE_INTEGER,infix:!1,prefix:!1,suffix:!1,ternary:!1,tkn:"",tin:-1,terms:1,token:{},OP_MARK:i}}return t},{})}(o,y,_),N=t(I,([e,n])=>[void 0,void 0,n.ctin,n]);let T=Object.values({...I,...N}).reduce((e,n)=>(e[n.otkn]=n.osrc,e[n.ctkn]=n.csrc,e),{}),M=Object.values({...E,...j,...O,...S}).reduce((e,n)=>(e[n.tkn]=n.src,e),{});e.options({fixed:{token:{...M,...T}},lex:{match:{comment:{order:1e5}}}});const P=l(E).map(e=>e.tin),C=l(O).map(e=>e.tin),R=l(j).map(e=>e.tin),w=l(S).filter(e=>0===e.use.ternary.opI).map(e=>e.tin),A=l(S).filter(e=>1===e.use.ternary.opI).map(e=>e.tin),L=l(I).map(e=>e.otin),F=l(N).map(e=>e.ctin),Y=0<P.length,U=0<C.length,$=0<R.length,J=0<w.length&&0<A.length,K=0<L.length&&0<F.length,B=e.token.CA,D=e.token.CS,V=e.token.CB,G=e.token.TX,z=e.token.NR,Z=e.token.ST,q=e.token.VL,X=e.token.ZZ,W=[G,z,Z,q];e.rule("val",n=>{J&&A.includes(e.token.CL)&&(n.def.open.find(e=>e.g.includes("pair")).c=e=>!e.n.expr_ternary),n.open([Y?{s:[P],b:1,n:{expr_prefix:1,expr_suffix:0},p:"expr",g:"expr,expr-prefix"}:null,K?{s:[L],b:1,p:"paren",c:(e,n)=>{let t=!0;return I[e.o0.tin].preval.required&&(t="val"===e.prev.name&&e.prev.use.paren_preval),t&&1===e.prev.i&&(n.root=()=>e),t},g:"expr,expr-paren"}:null]).close([J?{s:[w],c:e=>!e.n.expr,b:1,r:"ternary",g:"expr,expr-ternary"}:null,U?{s:[C],b:1,n:{expr_prefix:0,expr_suffix:0},r:e=>e.n.expr?"":"expr",g:"expr,expr-infix"}:null,$?{s:[R],b:1,n:{expr_prefix:0,expr_suffix:1},r:e=>e.n.expr?"":"expr",g:"expr,expr-suffix"}:null,K?{s:[F],c:e=>!!e.n.expr_paren,b:1,g:"expr,expr-paren"}:null,K?{s:[L],b:1,r:"val",c:e=>I[e.c0.tin].preval.active,u:{paren_preval:!0},g:"expr,expr-paren,expr-paren-preval"}:null,J?{s:[A],c:e=>!!e.n.expr_ternary,b:1,g:"expr,expr-ternary"}:null,{s:[B],c:e=>1===e.d&&(1<=e.n.expr||1<=e.n.expr_ternary)||1<=e.n.expr_ternary&&1<=e.n.expr_paren,b:1,g:"expr,list,val,imp,comma,top"},{s:[W],c:e=>1===e.d&&(1<=e.n.expr||1<=e.n.expr_ternary)||1<=e.n.expr_ternary&&1<=e.n.expr_paren,b:1,g:"expr,list,val,imp,space,top"}])}),e.rule("list",e=>{e.bo(!1,e=>{e.prev.use.implist||(e.n.expr=0,e.n.expr_prefix=0,e.n.expr_suffix=0,e.n.expr_paren=0,e.n.expr_ternary=0)}).close([K&&{s:[F],b:e=>D!==e.c0.tin||e.n.expr_paren?1:0}])}),e.rule("map",e=>{e.bo(!1,(...e)=>{e[0].n.expr=0,e[0].n.expr_prefix=0,e[0].n.expr_suffix=0,e[0].n.expr_paren=0,e[0].n.expr_ternary=0}).close([K&&{s:[F],b:e=>V!==e.c0.tin||e.n.expr_paren?1:0}])}),e.rule("elem",e=>{e.close([K?{s:[F],b:1,c:e=>!!e.n.expr_paren,g:"expr,expr-paren,imp,close,list"}:null,K?{s:[L],b:1,r:"elem",g:"expr,expr-paren,imp,open,list"}:null])}),e.rule("pair",e=>{e.close([K?{s:[F],b:1,c:e=>!!e.n.expr_paren||0<e.n.pk,g:"expr,expr-paren,imp,map"}:null])}),e.rule("expr",e=>{e.open([Y?{s:[P],c:e=>!!e.n.expr_prefix,n:{expr:1,dlist:1,dmap:1},p:"val",g:"expr,expr-prefix",a:e=>{const n=a(e.o0,E);e.node=x(e.parent.node)?k(e.parent.node,n):s(e,e.parent,n)}}:null,U?{s:[C],p:"val",n:{expr:1,expr_prefix:0,dlist:1,dmap:1},a:e=>{const n=e.prev,t=e.parent,r=a(e.o0,O);x(t.node)&&!g("ternary",t.node)?e.node=k(t.node,r):x(n.node)?(e.node=k(n.node,r),e.parent=n):e.node=s(e,n,r)},g:"expr,expr-infix"}:null,$?{s:[R],n:{expr:1,expr_prefix:0,dlist:1,dmap:1},a:e=>{const n=e.prev,t=a(e.o0,j);e.node=x(n.node)?k(n.node,t):s(e,n,t)},g:"expr,expr-suffix"}:null]).bc(e=>{var n;x(e.node)&&(null===(n=e.node)||void 0===n?void 0:n.length)-1<e.node[0].terms&&e.node.push(e.child.node)}).close([U?{s:[C],c:e=>!e.n.expr_prefix,b:1,r:"expr",g:"expr,expr-infix"}:null,$?{s:[R],c:e=>!e.n.expr_prefix,b:1,r:"expr",g:"expr,expr-suffix"}:null,K?{s:[F],c:e=>!!e.n.expr_paren,b:1}:null,J?{s:[w],c:e=>!e.n.expr_prefix,b:1,r:"ternary",g:"expr,expr-ternary"}:null,{s:[B],c:{d:0},n:{expr:0},r:"elem",a:e=>e.parent.node=e.node=[e.node],g:"expr,comma,list,top"},{s:[W],c:{d:0},n:{expr:0},b:1,r:"elem",a:e=>e.parent.node=e.node=[e.node],g:"expr,space,list,top"},{s:[B],c:{n:{pk:0}},n:{expr:0},b:1,h:m,g:"expr,list,val,imp,comma"},{c:{n:{pk:0,expr_suffix:0}},n:{expr:0},h:m,g:"expr,list,val,imp,space"},{n:{expr:0},g:"expr,expr-end"}]).ac(e=>{n.evaluate&&0===e.n.expr&&(e.parent.node=b(e.parent,e.parent.node,n.evaluate))})}),e.rule("paren",e=>{e.bo(e=>{e.n.dmap=0,e.n.dlist=0,e.n.pk=0}).open([K?{s:[L,F],b:1,g:"expr,expr-paren,empty",c:e=>I[e.o0.tin].name===N[e.o1.tin].name,a:p(I)}:null,K?{s:[L],p:"val",n:{expr_paren:1,expr:0,expr_prefix:0,expr_suffix:0},g:"expr,expr-paren,open",a:p(I)}:null]).close([K?{s:[F],c:e=>{let n="expr_paren_depth_"+N[e.c0.tin].name;return!!e.n[n]},a:d(N),g:"expr,expr-paren,close"}:null])}),J&&e.rule("ternary",e=>{e.open([{s:[w],p:"val",n:{expr_ternary:1,expr:0,expr_prefix:0,expr_suffix:0},u:{expr_ternary_step:1},g:"expr,expr-ternary,open",a:e=>{let n=a(e.o0,S);e.use.expr_ternary_name=n.name,x(e.prev.node)?e.node=u(e.prev.node,n,c(e.prev.node)):e.node=e.prev.node=u([],n,e.prev.node),e.use.expr_ternary_paren=e.n.expr_paren||e.prev.use.expr_ternary_paren||0,e.n.expr_paren=0}},{p:"val",c:e=>2===e.prev.use.expr_ternary_step,a:e=>{e.use.expr_ternary_step=e.prev.use.expr_ternary_step,e.n.expr_paren=e.use.expr_ternary_paren=e.prev.use.expr_ternary_paren},g:"expr,expr-ternary,step"}]).close([{s:[A],c:e=>1===e.use.expr_ternary_step&&e.use.expr_ternary_name===S[e.c0.tin].name,r:"ternary",a:e=>{e.use.expr_ternary_step++,e.node.push(e.child.node)},g:"expr,expr-ternary,step"},{s:[[B,...F]],c:f,b:(e,n)=>F.includes(n.t0.tin)?1:0,r:(e,n)=>{var t;return F.includes(n.t0.tin)||0!==e.d&&(!e.prev.use.expr_ternary_paren||(null===(t=e.parent.node)||void 0===t?void 0:t.length))?"":"elem"},a:h,g:"expr,expr-ternary,list,val,imp,comma"},{c:f,r:(e,n)=>{var t;return 0!==e.d&&F.includes(n.t0.tin)&&!e.prev.use.expr_ternary_paren||(null===(t=e.parent.node)||void 0===t?void 0:t.length)||X===n.t0.tin?"":"elem"},a:h,g:"expr,expr-ternary,list,val,imp,space"},{c:e=>0<e.d&&2===e.use.expr_ternary_step,a:e=>{e.node.push(e.child.node)},g:"expr,expr-ternary,close"}])})};function s(e,n,t){let r=n.node;return x(n.node)?r=c(n.node):n.node=[],u(n.node,t),t.prefix||(n.node[1]=r),e.parent=n,n.node}function a(e,n){return{...n[e.tin],token:e,OP_MARK:i}}function u(e,n,...t){let r=e;r[0]=n;let l=0;for(;l<t.length;l++)r[l+1]=t[l];return r.length=l+1,r}function c(e){return[...e]}function p(e){return function(n){let t="expr_paren_depth_"+a(n.o0,e).name;n.use[t]=n.n[t]=1,n.node=void 0}}function d(e){return function(n){(x(n.child.node)||void 0===n.node)&&(n.node=n.child.node);const t=a(n.c0,e);let r="expr_paren_depth_"+t.name;if(n.use[r]===n.n[r]){const e=n.node;n.node=[t],void 0!==e&&(n.node[1]=e),n.parent.prev.use.paren_preval&&(g("paren",n.parent.prev.node)?n.node=u(n.parent.prev.node,n.node[0],c(n.parent.prev.node),n.node[1]):(n.node.splice(1,0,n.parent.prev.node),n.parent.prev.node=n.node))}}}function m(e,n,t){let r=null;for(let l=n.rsI-1;-1<l;l--)if("paren"===n.rs[l].name){r=n.rs[l];break}return r&&(null==r.child.node?(r.child.node=[e.node],t.r="elem",t.b=0):x(r.child.node)&&(r.child.node=[r.child.node],t.r="elem",t.b=0),e.node=r.child.node),t}function f(e){return(0===e.d||1<=e.n.expr_paren)&&!e.n.pk&&2===e.use.expr_ternary_step}function h(e,n,t){e.n.expr_paren=e.prev.use.expr_ternary_paren,e.node.push(e.child.node),"elem"===t.r&&(e.node[0]=c(e.node),e.node.length=1)}function g(e,n){return null!=n&&x(n)&&!0===n[0][e]}function x(e){return null!=e&&e[0]&&e[0].OP_MARK===i}function v(e,n,t,r){return Object.entries(t).filter(([e,n])=>n[r]).reduce((t,[l,o])=>{let s="",a=-1,u="";u="string"==typeof o.src?o.src:o.src[0],a=n(u)||e("#E"+u),s=e(a);let c=t[a]={src:u,left:o.left||Number.MIN_SAFE_INTEGER,right:o.right||Number.MAX_SAFE_INTEGER,name:l+(l.endsWith("-"+r)?"":"-"+r),infix:"infix"===r,prefix:"prefix"===r,suffix:"suffix"===r,ternary:"ternary"===r,tkn:s,tin:a,terms:"ternary"===r?3:"infix"===r?2:1,use:{},paren:!1,osrc:"",csrc:"",otkn:"",ctkn:"",otin:-1,ctin:-1,preval:{active:!1,required:!1},token:{},OP_MARK:i};if(c.ternary){let r=o.src;c.src=r[0],c.use.ternary={opI:0};let l={...c};u=o.src[1],a=n(u)||e("#E"+u),s=e(a),l.src=u,l.use={ternary:{opI:1}},l.tkn=s,l.tin=a,t[a]=l}return t},{})}function k(e,n){let t=e,r=e[0];if(n)if(n.infix)if(r.suffix||n.left<=r.right)u(e,n,c(e));else{const l=r.terms;t=x(e[l])&&e[l][0].right<n.left?k(e[l],n):e[l]=u([],n,e[l])}else if(n.prefix)t=e[r.terms]=u([],n);else if(n.suffix)if(!r.suffix&&r.right<=n.left){const t=r.terms;x(e[t])&&e[t][0].prefix&&e[t][0].right<n.left?k(e[t],n):e[t]=u([],n,e[t])}else u(e,n,c(e));return t}function b(e,n,t){return null==n?n:x(n)?t(e,n[0],n.slice(1).map(n=>b(e,n,t))):n}n.Expr=o,o.defaults={op:{positive:{prefix:!0,right:14e3,src:"+"},negative:{prefix:!0,right:14e3,src:"-"},addition:{infix:!0,left:140,right:150,src:"+"},subtraction:{infix:!0,left:140,right:150,src:"-"},multiplication:{infix:!0,left:160,right:170,src:"*"},division:{infix:!0,left:160,right:170,src:"/"},remainder:{infix:!0,left:160,right:170,src:"%"},plain:{paren:!0,osrc:"(",csrc:")"}}},n.evaluate=b;const y={prattify:k,opify:e=>(e.OP_MARK=i,e)};return n.testing=y,n}));